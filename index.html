<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#0a0e27">
    <meta name="description" content="Ø¨Ø§Ø²ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø±ÛŒØ§Ø¶ÛŒ - Ù…ÙˆØ´Ú© ÙØ¶Ø§ÛŒÛŒ">
    <title>ðŸš€ Ø¨Ø§Ø²ÛŒ Ù…ÙˆØ´Ú© Ø±ÛŒØ§Ø¶ÛŒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            width: 100%;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }
        
        body {
            background: #0a0e27;
            background: linear-gradient(180deg, #0a0e27 0%, #1a1f3a 50%, #2a1f3a 100%);
            position: relative;
        }
        
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            user-select: text;
        }
        
        .hidden {
            display: none !important;
        }
        
        .ltr-content {
            direction: ltr !important;
            unicode-bidi: bidi-override;
        }
        
        .stars {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: 0;
            top: 0;
            left: 0;
            pointer-events: none;
        }
        
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        .space-object {
            position: absolute;
            font-size: clamp(20px, 4vw, 30px);
            animation: floatSpace 15s ease-in-out infinite;
            pointer-events: none;
        }
        
        @keyframes floatSpace {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(30px, -30px) rotate(90deg); }
            50% { transform: translate(-20px, 20px) rotate(180deg); }
            75% { transform: translate(20px, 30px) rotate(270deg); }
        }
        
        .main-menu,
        .level-select-screen,
        .settings-screen,
        .shop-screen,
        .stats-screen,
        .medals-screen,
        .tutorial-screen {
            position: relative;
            min-height: 100vh;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            z-index: 100;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 20px;
            padding-bottom: 100px;
        }
        
        .menu-container,
        .level-select-container,
        .settings-container,
        .shop-container,
        .stats-container,
        .medals-container,
        .tutorial-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: clamp(25px, 5vw, 40px);
            max-width: 600px;
            width: 100%;
            margin: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .game-logo {
            font-size: clamp(36px, 8vw, 52px);
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            text-align: center;
        }
        
        .game-subtitle {
            font-size: clamp(15px, 3.5vw, 18px);
            color: #7f8c8d;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .rocket-animation {
            font-size: clamp(60px, 12vw, 80px);
            margin: 20px 0;
            animation: floatRocket 3s ease-in-out infinite;
            display: block;
            text-align: center;
        }
        
        @keyframes floatRocket {
            0%, 100% { transform: translateY(0px) rotate(-5deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        .streak-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%);
            color: white;
            padding: 12px 25px;
            border-radius: 20px;
            font-weight: bold;
            font-size: clamp(15px, 3.5vw, 18px);
            margin: 20px auto;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
            animation: streakPulse 2s ease-in-out infinite;
        }
        
        @keyframes streakPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .streak-number {
            font-size: clamp(20px, 4.5vw, 26px);
            font-weight: bold;
        }
        
        .main-menu-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .menu-btn {
            background: white;
            border: 3px solid #3498db;
            padding: clamp(18px, 4vw, 25px);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: clamp(14px, 3vw, 16px);
            font-weight: bold;
            color: #2c3e50;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            min-height: 100px;
        }
        
        .menu-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }
        
        .menu-btn:active {
            transform: translateY(0);
        }
        
        .menu-btn-icon {
            font-size: clamp(32px, 7vw, 42px);
        }
        
        .menu-btn-title {
            font-size: clamp(15px, 3.5vw, 18px);
        }
        
        .menu-btn.primary {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }
        
        .menu-btn.success {
            border-color: #2ecc71;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        }
        
        .menu-btn.warning {
            border-color: #f39c12;
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        }
        
        .menu-btn.info {
            border-color: #3498db;
            background: linear-gradient(135deg, #d1ecf1 0%, #bee5eb 100%);
        }
        
        .menu-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
        }
        
        .menu-stat-item {
            text-align: center;
        }
        
        .menu-stat-icon {
            font-size: clamp(24px, 5vw, 32px);
            margin-bottom: 8px;
        }
        
        .menu-stat-value {
            font-size: clamp(18px, 4vw, 24px);
            font-weight: bold;
            color: #3498db;
        }
        
        .menu-stat-label {
            font-size: clamp(11px, 2.5vw, 13px);
            color: #7f8c8d;
            margin-top: 5px;
        }

        .screen-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            gap: 15px;
        }
        
        .back-button {
            background: #e74c3c;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 12px;
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .back-button:hover {
            background: #c0392b;
            transform: scale(1.05);
        }
        
        .back-button:active {
            transform: scale(0.95);
        }
        
        .screen-title {
            font-size: clamp(22px, 5vw, 30px);
            font-weight: bold;
            color: #2c3e50;
            flex: 1;
        }
        
        .level-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .level-card {
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            position: relative;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .level-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .level-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .level-card.locked::after {
            content: 'ðŸ”’';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 22px;
        }
        
        .level-card-icon {
            font-size: clamp(40px, 8vw, 55px);
            margin-bottom: 12px;
        }
        
        .level-card-name {
            font-size: clamp(17px, 4vw, 21px);
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .level-card-desc {
            font-size: clamp(12px, 2.5vw, 14px);
            color: #7f8c8d;
            margin-bottom: 12px;
        }
        
        .level-card-reward {
            background: #ffd700;
            color: #2c3e50;
            padding: 6px 12px;
            border-radius: 10px;
            font-size: clamp(12px, 2.5vw, 14px);
            font-weight: bold;
            display: inline-block;
        }
        
        .level-card.normal { border-color: #3498db; }
        .level-card.night { border-color: #34495e; background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); color: white; }
        .level-card.challenge { border-color: #e74c3c; background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); }
        .level-card.timed { border-color: #f39c12; background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%); }
        .level-card.infinite { border-color: #2ecc71; background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); }
        .level-card.hell { border-color: #8b0000; background: linear-gradient(135deg, #1a0000 0%, #8b0000 100%); color: white; }
        
        .level-card.night .level-card-name,
        .level-card.night .level-card-desc,
        .level-card.hell .level-card-name,
        .level-card.hell .level-card-desc {
            color: white;
        }
        
        .settings-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .settings-section-title {
            font-size: clamp(17px, 4vw, 21px);
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 12px;
        }
        
        .checkbox-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .checkbox-item:hover {
            border-color: #3498db;
            box-shadow: 0 3px 10px rgba(52, 152, 219, 0.2);
        }
        
        .checkbox-item.checked {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }
        
        .checkbox-item.locked {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .checkbox-icon {
            font-size: clamp(28px, 6vw, 36px);
            margin-bottom: 10px;
        }
        
        .checkbox-label {
            font-size: clamp(13px, 3vw, 16px);
            font-weight: bold;
        }
        
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .radio-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .radio-item:hover {
            border-color: #3498db;
        }
        
        .radio-item.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }
        
        .radio-circle {
            width: 26px;
            height: 26px;
            border: 3px solid #e0e0e0;
            border-radius: 50%;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        
        .radio-item.selected .radio-circle {
            border-color: #667eea;
            background: #667eea;
            box-shadow: inset 0 0 0 5px white;
        }
        
        .radio-content {
            flex: 1;
        }
        
        .radio-title {
            font-size: clamp(14px, 3.5vw, 17px);
            font-weight: bold;
            color: #2c3e50;
        }
        
        .radio-desc {
            font-size: clamp(12px, 2.5vw, 14px);
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .save-button {
            width: 100%;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            border: none;
            padding: clamp(18px, 4vw, 22px);
            border-radius: 12px;
            font-size: clamp(17px, 4vw, 21px);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 25px;
        }
        
        .save-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.3);
        }
        
        .save-button:active {
            transform: translateY(0);
        }

        .shop-balance {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }
        
        .shop-balance-amount {
            font-size: clamp(28px, 6vw, 40px);
            font-weight: bold;
            color: #2c3e50;
        }
        
        .shop-balance-label {
            font-size: clamp(13px, 3vw, 15px);
            color: #7f8c8d;
            margin-top: 8px;
        }
        
        .shop-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 10px;
        }
        
        .shop-tab {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 12px 22px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            font-size: clamp(13px, 3vw, 16px);
            font-weight: bold;
            color: #7f8c8d;
            flex-shrink: 0;
        }
        
        .shop-tab:hover {
            border-color: #3498db;
        }
        
        .shop-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }
        
        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .shop-item {
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            padding: 18px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            position: relative;
            min-height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .shop-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }
        
        .shop-item.owned {
            border-color: #2ecc71;
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1) 0%, rgba(39, 174, 96, 0.1) 100%);
        }
        
        .shop-item.equipped {
            border-color: #3498db;
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.2) 0%, rgba(41, 128, 185, 0.2) 100%);
        }
        
        .shop-item.locked {
            opacity: 0.6;
        }
        
        .shop-item-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #2ecc71;
            color: white;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: clamp(10px, 2vw, 12px);
            font-weight: bold;
        }
        
        .shop-item.equipped .shop-item-badge {
            background: #3498db;
        }
        
        .shop-item-icon {
            font-size: clamp(45px, 10vw, 65px);
            margin: 12px 0;
        }
        
        .shop-item-name {
            font-size: clamp(14px, 3vw, 17px);
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .shop-item-price {
            background: #ffd700;
            color: #2c3e50;
            padding: 8px 14px;
            border-radius: 10px;
            font-size: clamp(13px, 3vw, 15px);
            font-weight: bold;
            display: inline-block;
        }
        
        .shop-item.owned .shop-item-price {
            background: #2ecc71;
            color: white;
        }
        
        .shop-item-lock {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 22px;
        }
        
        .purchase-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }
        
        .purchase-modal-content {
            background: white;
            border-radius: 20px;
            padding: clamp(30px, 6vw, 45px);
            max-width: 420px;
            width: 100%;
            text-align: center;
            animation: modalPop 0.3s ease;
        }
        
        @keyframes modalPop {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .purchase-modal-icon {
            font-size: clamp(70px, 15vw, 90px);
            margin-bottom: 20px;
        }
        
        .purchase-modal-title {
            font-size: clamp(22px, 5vw, 28px);
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 12px;
        }
        
        .purchase-modal-desc {
            font-size: clamp(14px, 3vw, 16px);
            color: #7f8c8d;
            margin-bottom: 25px;
        }
        
        .purchase-modal-price {
            background: #ffd700;
            color: #2c3e50;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: clamp(20px, 4vw, 26px);
            font-weight: bold;
            display: inline-block;
            margin-bottom: 25px;
        }
        
        .purchase-modal-buttons {
            display: flex;
            gap: 12px;
        }
        
        .purchase-btn {
            flex: 1;
            padding: clamp(15px, 3vw, 18px);
            border: none;
            border-radius: 12px;
            font-size: clamp(15px, 3.5vw, 18px);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .purchase-btn.confirm {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }
        
        .purchase-btn.cancel {
            background: #e0e0e0;
            color: #7f8c8d;
        }
        
        .purchase-btn:hover {
            transform: translateY(-2px);
        }
        
        .purchase-btn:active {
            transform: translateY(0);
        }
        
        .purchase-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .stats-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 22px;
            margin: 20px 0;
        }
        
        .stats-card-title {
            font-size: clamp(17px, 4vw, 22px);
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 15px;
        }
        
        .stat-box {
            background: white;
            padding: 18px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e0e0e0;
        }
        
        .stat-box-icon {
            font-size: clamp(28px, 6vw, 36px);
            margin-bottom: 10px;
        }
        
        .stat-box-value {
            font-size: clamp(22px, 5vw, 30px);
            font-weight: bold;
            color: #3498db;
            margin-bottom: 8px;
        }
        
        .stat-box-label {
            font-size: clamp(12px, 2.5vw, 14px);
            color: #7f8c8d;
        }
        
        .progress-bar {
            background: #e0e0e0;
            height: 35px;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
            position: relative;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: clamp(13px, 3vw, 16px);
        }
        
        .medals-category {
            margin: 25px 0;
        }
        
        .medals-category-title {
            font-size: clamp(19px, 4.5vw, 26px);
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .medals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(145px, 1fr));
            gap: 15px;
        }
        
        .medal-card {
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 15px;
            padding: 18px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
            min-height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .medal-card.unlocked {
            border-color: #ffd700;
            box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
            animation: medalGlow 2s ease-in-out infinite;
        }
        
        @keyframes medalGlow {
            0%, 100% { box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3); }
            50% { box-shadow: 0 8px 30px rgba(255, 215, 0, 0.6); }
        }
        
        .medal-card.locked {
            opacity: 0.4;
            filter: grayscale(100%);
        }
        
        .medal-card-icon {
            font-size: clamp(45px, 10vw, 65px);
            margin: 12px 0;
        }
        
        .medal-card-name {
            font-size: clamp(14px, 3vw, 17px);
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .medal-card-desc {
            font-size: clamp(12px, 2.5vw, 14px);
            color: #7f8c8d;
        }
        
        .tutorial-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tutorial-tab {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 12px 22px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            font-size: clamp(13px, 3vw, 16px);
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .tutorial-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }
        
        .tutorial-content {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
        }
        
        .multiplication-table {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        
        .table-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .table-item:hover {
            border-color: #3498db;
            transform: scale(1.05);
        }
        
        .table-item-question {
            font-size: clamp(13px, 3vw, 15px);
            color: #7f8c8d;
            margin-bottom: 8px;
            direction: ltr;
        }
        
        .table-item-answer {
            font-size: clamp(18px, 4vw, 22px);
            font-weight: bold;
            color: #3498db;
        }
        
        .tips-list {
            list-style: none;
            padding: 0;
        }
        
        .tip-item {
            background: white;
            padding: 18px;
            border-radius: 12px;
            margin: 12px 0;
            border-left: 5px solid #3498db;
            display: flex;
            align-items: start;
            gap: 12px;
        }
        
        .tip-icon {
            font-size: 26px;
            flex-shrink: 0;
        }
        
        .tip-text {
            font-size: clamp(14px, 3vw, 16px);
            color: #2c3e50;
            line-height: 1.7;
        }
        
        .game-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            z-index: 1;
            overflow: hidden;
            touch-action: none;
        }
        
        .game-header {
            width: 100%;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            z-index: 10;
        }
        
        .game-back-btn {
            background: rgba(231, 76, 60, 0.95);
            backdrop-filter: blur(10px);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 12px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .game-back-btn:hover {
            background: rgba(192, 57, 43, 0.95);
            transform: scale(1.05);
        }
        
        .game-stats-bar {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 12px 20px;
            display: flex;
            gap: 18px;
            flex-wrap: wrap;
        }
        
        .game-stat {
            text-align: center;
            min-width: 70px;
        }
        
        .game-stat-label {
            font-size: clamp(11px, 2.5vw, 13px);
            color: rgba(255, 255, 255, 0.85);
            margin-bottom: 5px;
        }
        
        .game-stat-value {
            font-size: clamp(18px, 4vw, 24px);
            font-weight: bold;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .game-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .powerups-container {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 12px 0;
            flex-wrap: wrap;
        }
        
        .powerup-btn {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 12px;
            font-size: clamp(13px, 3vw, 15px);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .powerup-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(155, 89, 182, 0.4);
        }
        
        .powerup-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .powerup-icon {
            font-size: clamp(18px, 4vw, 22px);
        }
        
        .rocket-area {
            position: relative;
            width: 100%;
            max-width: 500px;
            height: clamp(220px, 35vh, 400px);
            margin: 15px 0;
        }
        
        .space-objects {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }
        
        .rocket {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            font-size: clamp(55px, 12vw, 85px);
            transition: bottom 0.5s ease;
            filter: drop-shadow(0 0 20px rgba(255, 100, 100, 0.6));
            z-index: 5;
        }
        
        .rocket-fire {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            font-size: clamp(40px, 9vw, 55px);
            animation: fireFlicker 0.1s infinite;
        }
        
        @keyframes fireFlicker {
            0%, 100% { opacity: 1; transform: translateX(-50%) scale(1); }
            50% { opacity: 0.8; transform: translateX(-50%) scale(1.15); }
        }
        
        .fuel-container {
            width: 100%;
            max-width: 550px;
            margin: 15px 0;
            padding: 0 15px;
        }
        
        .fuel-label {
            color: white;
            text-align: center;
            margin-bottom: 12px;
            font-size: clamp(15px, 3.5vw, 19px);
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .fuel-bar {
            width: 100%;
            height: clamp(40px, 7vw, 50px);
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 3px solid rgba(255, 255, 255, 0.4);
            border-radius: 25px;
            overflow: hidden;
            position: relative;
        }
        
        .fuel-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            transition: width 0.3s ease, background 0.3s ease;
            border-radius: 25px;
            box-shadow: 0 0 25px rgba(46, 204, 113, 0.6);
        }
        
        .fuel-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: clamp(14px, 3vw, 17px);
            text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.8);
            z-index: 1;
        }
        
        .question-box {
            background: rgba(255, 255, 255, 0.97);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: clamp(22px, 4vw, 32px);
            max-width: 550px;
            width: 100%;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            margin: 15px;
        }
        
        .level-badge {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            font-size: clamp(13px, 3vw, 15px);
            margin-bottom: 15px;
            color: white;
        }
        
        .question-text {
            font-size: clamp(36px, 8vw, 52px);
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 22px;
            direction: ltr !important;
            font-family: 'Courier New', monospace !important;
            letter-spacing: 4px;
            unicode-bidi: bidi-override;
            text-align: center;
            display: block;
        }
        
        .answer-input {
            width: 100%;
            padding: clamp(16px, 3.5vw, 20px);
            font-size: clamp(24px, 5.5vw, 30px);
            text-align: center;
            border: 3px solid #3498db;
            border-radius: 12px;
            margin-bottom: 18px;
            outline: none;
            direction: ltr;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .answer-input:focus {
            border-color: #2ecc71;
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.4);
            transform: scale(1.02);
        }
        
        .answer-input.correct {
            border-color: #2ecc71;
            background: #d4edda;
        }
        
        .answer-input.wrong {
            border-color: #e74c3c;
            background: #f8d7da;
        }
        
        .submit-button {
            width: 100%;
            max-width: 320px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: clamp(16px, 3.5vw, 20px);
            font-size: clamp(17px, 4vw, 21px);
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .submit-button:active {
            transform: translateY(0);
        }
        
        .submit-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .coin-animation {
            position: fixed;
            font-size: 42px;
            pointer-events: none;
            z-index: 9999;
            animation: coinFly 1s ease-out forwards;
        }
        
        @keyframes coinFly {
            0% {
                transform: translate(0, 0) scale(1) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translate(0, -150px) scale(0.5) rotate(720deg);
                opacity: 0;
            }
        }

        .feedback-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(90px, 20vw, 150px);
            font-weight: bold;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            text-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
            transition: opacity 0.3s;
        }
        
        .feedback-overlay.show {
            opacity: 1;
            animation: feedbackBounce 0.6s ease;
        }
        
        @keyframes feedbackBounce {
            0% { transform: translate(-50%, -50%) scale(0) rotate(0deg); }
            50% { transform: translate(-50%, -50%) scale(1.2) rotate(10deg); }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
        }
        
        .combo-badge {
            position: fixed;
            top: clamp(100px, 15vh, 140px);
            right: 20px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: clamp(14px, 3vw, 20px) clamp(22px, 4vw, 32px);
            border-radius: 18px;
            font-size: clamp(22px, 5vw, 30px);
            font-weight: bold;
            z-index: 100;
            box-shadow: 0 6px 25px rgba(245, 87, 108, 0.6);
            animation: comboBounce 0.5s ease;
            border: 3px solid rgba(255, 255, 255, 0.5);
        }
        
        @keyframes comboBounce {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.15) rotate(-5deg); }
            75% { transform: scale(1.15) rotate(5deg); }
        }
        
        .combo-text {
            display: block;
            font-size: clamp(13px, 3vw, 15px);
            margin-top: 5px;
            opacity: 0.9;
        }
        
        .game-over-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 25px;
            animation: modalFadeIn 0.3s ease;
            overflow-y: auto;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .game-over-content {
            background: white;
            border-radius: 25px;
            padding: clamp(30px, 6vw, 45px);
            max-width: 550px;
            width: 100%;
            text-align: center;
            animation: modalSlideUp 0.4s ease;
            max-height: 90vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        @keyframes modalSlideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .game-over-icon {
            font-size: clamp(80px, 16vw, 110px);
            margin: 20px 0;
            animation: iconSpin 0.6s ease;
        }
        
        @keyframes iconSpin {
            0% { transform: rotate(0deg) scale(0); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }
        
        .game-over-title {
            font-size: clamp(28px, 6vw, 38px);
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 18px;
        }
        
        .game-over-subtitle {
            font-size: clamp(15px, 3.5vw, 19px);
            color: #7f8c8d;
            margin-bottom: 25px;
        }
        
        .new-medal-notification {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            padding: 18px;
            border-radius: 15px;
            margin: 18px 0;
            animation: medalNotifPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes medalNotifPulse {
            0%, 100% { box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4); }
            50% { box-shadow: 0 8px 35px rgba(255, 215, 0, 0.7); }
        }
        
        .new-medal-text {
            font-size: clamp(17px, 4vw, 21px);
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 12px;
        }
        
        .new-medals-list {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .new-medal-item {
            font-size: clamp(36px, 8vw, 52px);
            animation: medalBounce 0.6s ease infinite;
        }
        
        @keyframes medalBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .final-stats-grid {
            background: #f8f9fa;
            padding: 22px;
            border-radius: 15px;
            margin: 25px 0;
        }
        
        .final-stat-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 2px solid #e0e0e0;
            font-size: clamp(15px, 3.5vw, 19px);
        }
        
        .final-stat-row:last-child {
            border-bottom: none;
        }
        
        .final-stat-label {
            color: #7f8c8d;
            font-weight: 500;
        }
        
        .final-stat-value {
            color: #3498db;
            font-weight: bold;
        }
        
        .coin-reward {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #2c3e50;
            padding: 15px 25px;
            border-radius: 15px;
            font-size: clamp(20px, 4.5vw, 26px);
            font-weight: bold;
            display: inline-block;
            margin: 18px 0;
            animation: coinShine 1s ease-in-out infinite;
        }
        
        @keyframes coinShine {
            0%, 100% { box-shadow: 0 5px 15px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 8px 25px rgba(255, 215, 0, 0.8); }
        }
        
        .game-over-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }
        
        .game-over-btn {
            flex: 1;
            padding: clamp(16px, 3.5vw, 20px);
            border: none;
            border-radius: 12px;
            font-size: clamp(16px, 3.5vw, 19px);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 140px;
        }
        
        .game-over-btn.restart {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .game-over-btn.menu {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }
        
        .game-over-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        .game-over-btn:active {
            transform: translateY(0);
        }
        
        .medal-unlock-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: clamp(35px, 7vw, 55px);
            border-radius: 25px;
            text-align: center;
            z-index: 3000;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            max-width: 90%;
            width: 450px;
        }
        
        .medal-unlock-modal.show {
            animation: medalUnlockPop 0.6s ease forwards;
        }
        
        @keyframes medalUnlockPop {
            0% { transform: translate(-50%, -50%) scale(0) rotate(-180deg); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.15) rotate(10deg); }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
        }
        
        .medal-unlock-icon {
            font-size: clamp(90px, 18vw, 130px);
            margin-bottom: 25px;
            animation: medalRotate 3s ease-in-out infinite;
        }
        
        @keyframes medalRotate {
            0%, 100% { transform: rotate(-15deg) scale(1); }
            50% { transform: rotate(15deg) scale(1.1); }
        }
        
        .medal-unlock-title {
            font-size: clamp(24px, 5.5vw, 34px);
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .medal-unlock-desc {
            font-size: clamp(15px, 3.5vw, 19px);
            color: #7f8c8d;
            margin-bottom: 30px;
        }
        
        .medal-unlock-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: clamp(14px, 3vw, 18px) clamp(30px, 6vw, 40px);
            font-size: clamp(16px, 3.5vw, 19px);
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .medal-unlock-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .fullscreen-toggle,
        .sound-toggle {
            position: fixed;
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(10px);
            border: 3px solid rgba(52, 152, 219, 0.5);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 150;
            font-size: 26px;
        }
        
        .fullscreen-toggle {
            bottom: 100px;
            right: 25px;
        }
        
        .sound-toggle {
            bottom: 25px;
            right: 25px;
        }
        
        .fullscreen-toggle:hover,
        .sound-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(52, 152, 219, 0.4);
        }
        
        .fullscreen-toggle:active,
        .sound-toggle:active {
            transform: scale(0.95);
        }
        
        .sound-toggle.muted {
            background: rgba(231, 76, 60, 0.92);
            border-color: rgba(192, 57, 43, 0.5);
            color: white;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #0a0e27 0%, #1a1f3a 50%, #2a1f3a 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5000;
            flex-direction: column;
            gap: 25px;
        }
        
        .loading-rocket {
            font-size: clamp(70px, 15vw, 110px);
            animation: loadingBounce 1s ease-in-out infinite;
        }
        
        @keyframes loadingBounce {
            0%, 100% { transform: translateY(0) rotate(-10deg); }
            50% { transform: translateY(-30px) rotate(10deg); }
        }
        
        .loading-text {
            color: white;
            font-size: clamp(20px, 4vw, 26px);
            font-weight: bold;
        }
        
        .loading-bar {
            width: 220px;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .loading-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            animation: loadingProgress 1.5s ease-in-out infinite;
        }
        
        @keyframes loadingProgress {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        }
        
        @media (max-width: 768px) {
            .main-menu-buttons {
                grid-template-columns: 1fr;
            }
            
            .level-grid {
                grid-template-columns: 1fr;
            }
            
            .shop-items {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .medals-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .game-over-buttons {
                flex-direction: column;
            }
            
            .game-over-btn {
                width: 100%;
            }
            
            .combo-badge {
                top: 80px;
                right: 15px;
                padding: 12px 18px;
            }
        }
        
        @media (max-width: 480px) {
            .shop-items {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .menu-stats {
                grid-template-columns: 1fr;
            }
            
            .game-stats-bar {
                justify-content: center;
            }
            
            .purchase-modal-buttons {
                flex-direction: column;
            }
        }
        
        @media (max-height: 600px) and (orientation: landscape) {
            .rocket-area {
                height: 140px !important;
            }
            
            .question-box {
                padding: 15px !important;
                margin: 10px !important;
            }
        }
        
        .shake {
            animation: shake 0.5s ease;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
    </style>
</head>
<body>
    <div class="stars" id="starsContainer"></div>
    
    <div class="loading-screen hidden" id="loadingScreen">
        <div class="loading-rocket">ðŸš€</div>
        <div class="loading-text">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
        <div class="loading-bar">
            <div class="loading-bar-fill"></div>
        </div>
    </div>
    
    <div class="fullscreen-toggle" id="fullscreenToggle" title="ØªÙ…Ø§Ù… ØµÙØ­Ù‡">â›¶</div>
    <div class="sound-toggle" id="soundToggle" title="ØµØ¯Ø§">ðŸ”Š</div>
    
    <div class="main-menu" id="mainMenu">
        <div class="menu-container">
            <div class="game-logo">ðŸš€ Ù…ÙˆØ´Ú© Ø±ÛŒØ§Ø¶ÛŒ</div>
            <div class="game-subtitle">Ù…Ø§Ø¬Ø±Ø§Ø¬ÙˆÛŒÛŒ Ø¯Ø± Ø¯Ù†ÛŒØ§ÛŒ Ø§Ø¹Ø¯Ø§Ø¯!</div>
            <div class="rocket-animation">ðŸš€</div>
            
            <div style="text-align: center;">
                <div class="streak-badge" id="streakBadge">
                    ðŸ”¥ <span class="streak-number" id="streakNumber">0</span> Ø±ÙˆØ² Ø§Ø³ØªØ±Ø§ÛŒÚ©
                </div>
            </div>
            
            <div class="menu-stats">
                <div class="menu-stat-item">
                    <div class="menu-stat-icon">ðŸ’°</div>
                    <div class="menu-stat-value" id="menuCoins">0</div>
                    <div class="menu-stat-label">Ø³Ú©Ù‡</div>
                </div>
                <div class="menu-stat-item">
                    <div class="menu-stat-icon">ðŸ†</div>
                    <div class="menu-stat-value" id="menuHighscore">0</div>
                    <div class="menu-stat-label">Ø±Ú©ÙˆØ±Ø¯ (Ù…ØªØ±)</div>
                </div>
                <div class="menu-stat-item">
                    <div class="menu-stat-icon">ðŸ…</div>
                    <div class="menu-stat-value" id="menuMedals">0</div>
                    <div class="menu-stat-label">Ù…Ø¯Ø§Ù„</div>
                </div>
            </div>
            
            <div class="main-menu-buttons">
                <button class="menu-btn primary" onclick="showLevelSelect()">
                    <span class="menu-btn-icon">ðŸŽ®</span>
                    <span class="menu-btn-title">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ</span>
                </button>
                
                <button class="menu-btn success" onclick="showSettings()">
                    <span class="menu-btn-icon">âš™ï¸</span>
                    <span class="menu-btn-title">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</span>
                </button>
                
                <button class="menu-btn warning" onclick="showShop()">
                    <span class="menu-btn-icon">ðŸ›’</span>
                    <span class="menu-btn-title">ÙØ±ÙˆØ´Ú¯Ø§Ù‡</span>
                </button>
                
                <button class="menu-btn info" onclick="showStats()">
                    <span class="menu-btn-icon">ðŸ“Š</span>
                    <span class="menu-btn-title">Ø¢Ù…Ø§Ø± Ù…Ù†</span>
                </button>
                
                <button class="menu-btn info" onclick="showMedals()">
                    <span class="menu-btn-icon">ðŸ†</span>
                    <span class="menu-btn-title">Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§</span>
                </button>
                
                <button class="menu-btn success" onclick="showTutorial()">
                    <span class="menu-btn-icon">ðŸ“š</span>
                    <span class="menu-btn-title">Ø¢Ù…ÙˆØ²Ø´</span>
                </button>
            </div>
            
            <div style="margin-top: 25px; padding: 18px; background: #f8f9fa; border-radius: 15px; text-align: center;">
                <p style="font-size: clamp(12px, 2.5vw, 14px); color: #7f8c8d; margin-bottom: 10px;">
                    Ù†Ø³Ø®Ù‡ 2.1 ÙØ§ÛŒÙ†Ø§Ù„ | Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ â¤ï¸
                </p>
                <a href="https://github.com/ittzvon/jet-math" target="_blank" rel="noopener noreferrer" 
                   style="display: inline-flex; align-items: center; gap: 8px; color: #3498db; text-decoration: none; font-size: clamp(12px, 2.5vw, 14px); font-weight: bold; transition: color 0.3s;">
                    <span>â­</span>
                    <span>Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± GitHub</span>
                    <span>â†—</span>
                </a>
            </div>
        </div>
    </div>
    
    <div class="level-select-screen hidden" id="levelSelectScreen">
        <div class="level-select-container">
            <div class="screen-header">
                <button class="back-button" onclick="showMainMenu()">â†©</button>
                <h2 class="screen-title">Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø·Ø­</h2>
            </div>
            <div class="level-grid" id="levelGrid"></div>
        </div>
    </div>
    
    <div class="settings-screen hidden" id="settingsScreen">
        <div class="settings-container">
            <div class="screen-header">
                <button class="back-button" onclick="showMainMenu()">â†©</button>
                <h2 class="screen-title">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÙˆØ§Ù„Ø§Øª</h2>
            </div>
            
            <div class="settings-section">
                <div class="settings-section-title">
                    <span>âž•</span>
                    Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ù…Ù„ÛŒØ§Øªâ€ŒÙ‡Ø§
                </div>
                <div class="checkbox-group" id="operationsCheckbox"></div>
            </div>
            
            <div class="settings-section">
                <div class="settings-section-title">
                    <span>ðŸ“Š</span>
                    Ø³Ø·Ø­ Ø³Ø®ØªÛŒ
                </div>
                <div class="radio-group" id="difficultyRadio"></div>
            </div>
            
            <button class="save-button" onclick="saveSettings()">
                ðŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ
            </button>
        </div>
    </div>
    
    <div class="shop-screen hidden" id="shopScreen">
        <div class="shop-container">
            <div class="screen-header">
                <button class="back-button" onclick="showMainMenu()">â†©</button>
                <h2 class="screen-title">ÙØ±ÙˆØ´Ú¯Ø§Ù‡</h2>
            </div>
            
            <div class="shop-balance">
                <div class="shop-balance-amount">
                    ðŸ’° <span id="shopCoins">0</span>
                </div>
                <div class="shop-balance-label">Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§</div>
            </div>
            
            <div class="shop-tabs">
                <button class="shop-tab active" onclick="switchShopTab('rockets')">ðŸš€ Ù…ÙˆØ´Ú©â€ŒÙ‡Ø§</button>
                <button class="shop-tab" onclick="switchShopTab('backgrounds')">ðŸŒŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡</button>
                <button class="shop-tab" onclick="switchShopTab('music')">ðŸŽµ Ù…ÙˆØ²ÛŒÚ©</button>
                <button class="shop-tab" onclick="switchShopTab('effects')">âœ¨ Ø¬Ù„ÙˆÙ‡â€ŒÙ‡Ø§</button>
                <button class="shop-tab" onclick="switchShopTab('titles')">ðŸ‘‘ Ù„Ù‚Ø¨â€ŒÙ‡Ø§</button>
                <button class="shop-tab" onclick="switchShopTab('powerups')">âš¡ Ù¾Ø§ÙˆØ±Ø§Ù¾</button>
            </div>
            
            <div class="shop-items" id="shopItems"></div>
        </div>
    </div>
    
    <div class="purchase-modal hidden" id="purchaseModal">
        <div class="purchase-modal-content">
            <div class="purchase-modal-icon" id="purchaseIcon">ðŸš€</div>
            <div class="purchase-modal-title" id="purchaseTitle">Ø®Ø±ÛŒØ¯ Ø¢ÛŒØªÙ…</div>
            <div class="purchase-modal-desc" id="purchaseDesc">Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒ Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ø±Ùˆ Ø¨Ø®Ø±ÛŒØŸ</div>
            <div class="purchase-modal-price" id="purchasePrice">ðŸ’° 100</div>
            <div class="purchase-modal-buttons">
                <button class="purchase-btn confirm" id="confirmPurchaseBtn">âœ… Ø®Ø±ÛŒØ¯</button>
                <button class="purchase-btn cancel" onclick="closePurchaseModal()">âŒ Ø§Ù†ØµØ±Ø§Ù</button>
            </div>
        </div>
    </div>
    
    <div class="stats-screen hidden" id="statsScreen">
        <div class="stats-container">
            <div class="screen-header">
                <button class="back-button" onclick="showMainMenu()">â†©</button>
                <h2 class="screen-title">Ø¢Ù…Ø§Ø± Ù…Ù†</h2>
            </div>
            
            <div class="stats-card">
                <div class="stats-card-title">
                    <span>ðŸ“ˆ</span>
                    Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ
                </div>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-box-icon">ðŸŽ®</div>
                        <div class="stat-box-value" id="totalGames">0</div>
                        <div class="stat-box-label">Ø¨Ø§Ø²ÛŒ Ú©Ù„</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-icon">âœ…</div>
                        <div class="stat-box-value" id="totalCorrect">0</div>
                        <div class="stat-box-label">Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-icon">âŒ</div>
                        <div class="stat-box-value" id="totalWrong">0</div>
                        <div class="stat-box-label">Ù¾Ø§Ø³Ø® ØºÙ„Ø·</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-icon">ðŸ†</div>
                        <div class="stat-box-value" id="bestAltitude">0</div>
                        <div class="stat-box-label">Ø¨Ù‡ØªØ±ÛŒÙ† Ø§Ø±ØªÙØ§Ø¹</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-icon">ðŸ’°</div>
                        <div class="stat-box-value" id="totalCoins">0</div>
                        <div class="stat-box-label">Ú©Ù„ Ø³Ú©Ù‡</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-icon">ðŸ…</div>
                        <div class="stat-box-value" id="totalMedalsCount">0</div>
                        <div class="stat-box-label">Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-icon">ðŸ”¥</div>
                        <div class="stat-box-value" id="bestCombo">0</div>
                        <div class="stat-box-label">Ø¨Ù‡ØªØ±ÛŒÙ† Ú©Ù…Ø¨Ùˆ</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-box-icon">ðŸ“…</div>
                        <div class="stat-box-value" id="currentStreak">0</div>
                        <div class="stat-box-label">Ø§Ø³ØªØ±Ø§ÛŒÚ© ÙØ¹Ù„ÛŒ</div>
                    </div>
                </div>
            </div>
            
            <div class="stats-card">
                <div class="stats-card-title">
                    <span>ðŸ“Š</span>
                    Ø¯Ø±ØµØ¯ Ù…ÙˆÙÙ‚ÛŒØª
                </div>
                <div class="progress-bar">
                    <div class="progress-bar-fill" id="successRate" style="width: 0%;">0%</div>
                </div>
            </div>
            
            <div class="stats-card">
                <div class="stats-card-title">
                    <span>ðŸ‘‘</span>
                    Ø±ØªØ¨Ù‡ Ø´Ù…Ø§
                </div>
                <div style="text-align: center; padding: 25px;">
                    <div style="font-size: clamp(60px, 12vw, 90px);" id="rankIcon">ðŸ¥‰</div>
                    <div style="font-size: clamp(22px, 5vw, 30px); font-weight: bold; color: #3498db; margin-top: 15px;" id="rankName">Ù…Ø¨ØªØ¯ÛŒ</div>
                </div>
            </div>
        </div>
    </div>

    <div class="medals-screen hidden" id="medalsScreen">
        <div class="medals-container">
            <div class="screen-header">
                <button class="back-button" onclick="showMainMenu()">â†©</button>
                <h2 class="screen-title">Ù…Ø¯Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ù…Ù†</h2>
            </div>
            <div id="medalsContent"></div>
        </div>
    </div>
    
    <div class="tutorial-screen hidden" id="tutorialScreen">
        <div class="tutorial-container">
            <div class="screen-header">
                <button class="back-button" onclick="showMainMenu()">â†©</button>
                <h2 class="screen-title">Ø¢Ù…ÙˆØ²Ø´</h2>
            </div>
            
            <div class="tutorial-tabs">
                <button class="tutorial-tab active" onclick="switchTutorialTab('multiply')">âœ–ï¸ Ø¬Ø¯ÙˆÙ„ Ø¶Ø±Ø¨</button>
                <button class="tutorial-tab" onclick="switchTutorialTab('tips')">ðŸ’¡ Ù†Ú©Ø§Øª</button>
                <button class="tutorial-tab" onclick="switchTutorialTab('guide')">ðŸ“– Ø±Ø§Ù‡Ù†Ù…Ø§</button>
            </div>
            
            <div class="tutorial-content" id="tutorialContent"></div>
        </div>
    </div>
    
    <div class="game-screen hidden" id="gameScreen">
        <div class="game-header">
            <button class="game-back-btn" onclick="pauseGame()" title="Ø¨Ø§Ø²Ú¯Ø´Øª">â†©</button>
            
            <div class="game-stats-bar">
                <div class="game-stat">
                    <div class="game-stat-label">Ø§Ù…ØªÛŒØ§Ø²</div>
                    <div class="game-stat-value" id="gameScore">0</div>
                </div>
                <div class="game-stat">
                    <div class="game-stat-label">Ø§Ø±ØªÙØ§Ø¹</div>
                    <div class="game-stat-value" id="gameAltitude">0</div>
                </div>
                <div class="game-stat">
                    <div class="game-stat-label">Ø±Ú©ÙˆØ±Ø¯</div>
                    <div class="game-stat-value" id="gameRecord">0</div>
                </div>
                <div class="game-stat">
                    <div class="game-stat-label">ðŸ’°</div>
                    <div class="game-stat-value" id="gameCoins">0</div>
                </div>
            </div>
        </div>
        
        <div class="game-content">
            <div class="powerups-container" id="powerupsContainer"></div>
            
            <div class="rocket-area">
                <div class="space-objects" id="spaceObjects"></div>
                <div class="rocket" id="rocket">
                    ðŸš€
                    <div class="rocket-fire">ðŸ”¥</div>
                </div>
            </div>
            
            <div class="fuel-container">
                <div class="fuel-label">â›½ Ø³ÙˆØ®Øª: <span id="fuelTime">20</span> Ø«Ø§Ù†ÛŒÙ‡</div>
                <div class="fuel-bar">
                    <div class="fuel-fill" id="fuelFill" style="width: 100%;"></div>
                    <div class="fuel-text" id="fuelPercent">100%</div>
                </div>
            </div>
            
            <div class="question-box">
                <div class="level-badge" id="levelBadge">Ø¹Ø§Ø¯ÛŒ ðŸŒŸ</div>
                <div class="question-text ltr-content" id="questionText">8 Ã— 7 = ?</div>
                <input 
                    type="tel" 
                    class="answer-input ltr-content" 
                    id="answerInput" 
                    placeholder="Ù¾Ø§Ø³Ø®"
                    inputmode="numeric"
                    pattern="[0-9]*"
                    autocomplete="off"
                />
                <button class="submit-button" onclick="submitAnswer()" id="submitButton">
                    âœ… Ø«Ø¨Øª Ù¾Ø§Ø³Ø®
                </button>
            </div>
        </div>
    </div>
    
    <div class="feedback-overlay" id="feedbackOverlay"></div>
    
    <div class="combo-badge hidden" id="comboBadge">
        <div>ðŸ”¥ Ú©Ù…Ø¨Ùˆ</div>
        <div class="combo-text" id="comboCount">5</div>
    </div>
    
    <div class="game-over-modal hidden" id="gameOverModal">
        <div class="game-over-content">
            <div class="game-over-icon" id="gameOverIcon">ðŸŽ®</div>
            <div class="game-over-title" id="gameOverTitle">Ø¨Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ø´Ø¯!</div>
            <div class="game-over-subtitle" id="gameOverSubtitle">Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø®ÙˆØ¨ÛŒ Ø¯Ø§Ø´ØªÛŒ!</div>
            
            <div class="new-medal-notification hidden" id="newMedalNotif">
                <div class="new-medal-text">ðŸŽ‰ Ù…Ø¯Ø§Ù„ Ø¬Ø¯ÛŒØ¯ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯ÛŒ!</div>
                <div class="new-medals-list" id="newMedalsList"></div>
            </div>
            
            <div class="final-stats-grid">
                <div class="final-stat-row">
                    <span class="final-stat-label">Ø§Ø±ØªÙØ§Ø¹ Ù†Ù‡Ø§ÛŒÛŒ:</span>
                    <span class="final-stat-value" id="finalAltitude">0 Ù…ØªØ±</span>
                </div>
                <div class="final-stat-row">
                    <span class="final-stat-label">Ø§Ù…ØªÛŒØ§Ø² Ú©Ù„:</span>
                    <span class="final-stat-value" id="finalScore">0</span>
                </div>
                <div class="final-stat-row">
                    <span class="final-stat-label">Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª:</span>
                    <span class="final-stat-value" id="finalCorrect">0</span>
                </div>
                <div class="final-stat-row">
                    <span class="final-stat-label">Ù¾Ø§Ø³Ø® ØºÙ„Ø·:</span>
                    <span class="final-stat-value" id="finalWrong">0</span>
                </div>
                <div class="final-stat-row">
                    <span class="final-stat-label">Ø¨Ù‡ØªØ±ÛŒÙ† Ú©Ù…Ø¨Ùˆ:</span>
                    <span class="final-stat-value" id="finalBestCombo">0</span>
                </div>
            </div>
            
            <div class="coin-reward" id="coinReward">
                ðŸ’° +50 Ø³Ú©Ù‡
            </div>
            
            <div class="game-over-buttons">
                <button class="game-over-btn restart" onclick="restartGame()">
                    ðŸ”„ Ø¨Ø§Ø²ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡
                </button>
                <button class="game-over-btn menu" onclick="backToMainMenu()">
                    ðŸ  Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ
                </button>
            </div>
        </div>
    </div>
    
    <div class="medal-unlock-modal" id="medalUnlockModal">
        <div class="medal-unlock-icon" id="medalUnlockIcon">ðŸ†</div>
        <div class="medal-unlock-title" id="medalUnlockTitle">Ù…Ø¯Ø§Ù„ Ø¬Ø¯ÛŒØ¯!</div>
        <div class="medal-unlock-desc" id="medalUnlockDesc">ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø¯Ø§Ù„</div>
        <button class="medal-unlock-btn" onclick="closeMedalUnlock()">
            Ø¹Ø§Ù„ÛŒ! ðŸŽ‰
        </button>
    </div>

    <script>
let gameState = {
    score: 0,
    altitude: 0,
    coins: 0,
    fuel: 20,
    maxFuel: 20,
    currentLevel: 'normal',
    combo: 0,
    maxCombo: 0,
    correctAnswers: 0,
    wrongAnswers: 0,
    totalGames: 0,
    bestAltitude: 0,
    isPlaying: false,
    currentQuestion: null,
    fuelTimer: null,
    soundEnabled: true,
    powerups: {
        timeBoost: 3,
        skipQuestion: 3
    }
};

let userSettings = {
    operations: ['+', '-', 'Ã—', 'Ã·'],
    difficulty: 'medium',
    equippedRocket: 'ðŸš€',
    equippedBackground: 'default',
    equippedMusic: 'default',
    equippedEffect: 'default',
    equippedTitle: null
};

let inventory = {
    rockets: ['ðŸš€'],
    backgrounds: ['default'],
    music: ['default'],
    effects: ['default'],
    titles: []
};

let unlockedMedals = [];
let newMedalsThisGame = [];

let streakData = {
    current: 0,
    lastPlayDate: null,
    best: 0
};

let audioContext = null;
let shootingStarInterval = null;

const gameLevels = {
    normal: {
        name: 'Ø¹Ø§Ø¯ÛŒ',
        icon: 'ðŸŒŸ',
        desc: 'Ø¨Ø§Ø²ÛŒ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯',
        color: '#3498db',
        initialFuel: 25,
        fuelBonus: 20,
        fuelPenalty: 2,
        coinMultiplier: 1,
        locked: false,
        unlockCost: 0
    },
    night: {
        name: 'Ø´Ø¨',
        icon: 'ðŸŒ™',
        desc: 'ÙØ¶Ø§ÛŒ ØªØ§Ø±ÛŒÚ©â€ŒØªØ±',
        color: '#34495e',
        initialFuel: 20,
        fuelBonus: 18,
        fuelPenalty: 2,
        coinMultiplier: 1.5,
        locked: false,
        unlockCost: 0
    },
    challenge: {
        name: 'Ú†Ø§Ù„Ø´',
        icon: 'âš¡',
        desc: 'Ø³ÙˆØ§Ù„Ø§Øª Ø³Ø®Øªâ€ŒØªØ±',
        color: '#e74c3c',
        initialFuel: 15,
        fuelBonus: 12,
        fuelPenalty: 4,
        coinMultiplier: 2,
        locked: false,
        unlockCost: 0
    },
    timed: {
        name: 'Ø²Ù…Ø§Ù†â€ŒØ¯Ø§Ø±',
        icon: 'â±ï¸',
        desc: '2 Ø¯Ù‚ÛŒÙ‚Ù‡ ÙˆÙ‚Øª Ø¯Ø§Ø±ÛŒ',
        color: '#f39c12',
        initialFuel: 120,
        fuelBonus: 5,
        fuelPenalty: 10,
        coinMultiplier: 1.5,
        locked: false,
        unlockCost: 0
    },
    infinite: {
        name: 'ØªÙ…Ø±ÛŒÙ†',
        icon: 'â™¾ï¸',
        desc: 'Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª',
        color: '#2ecc71',
        initialFuel: 999,
        fuelBonus: 0,
        fuelPenalty: 0,
        coinMultiplier: 0,
        locked: false,
        unlockCost: 0
    },
    hell: {
        name: 'Ø¬Ù‡Ù†Ù…ÛŒ',
        icon: 'ðŸ”¥',
        desc: 'Ø¨Ø±Ø§ÛŒ Ù†Ø§Ø¨ØºÙ‡â€ŒÙ‡Ø§!',
        color: '#8b0000',
        initialFuel: 10,
        fuelBonus: 8,
        fuelPenalty: 5,
        coinMultiplier: 3,
        locked: true,
        unlockCost: 1000
    }
};

const difficultyLevels = {
    veryEasy: {
        name: 'Ø®ÛŒÙ„ÛŒ Ø¢Ø³Ø§Ù†',
        icon: 'ðŸŸ¢',
        desc: 'ÛŒÚ© Ø±Ù‚Ù…ÛŒ + ÛŒÚ© Ø±Ù‚Ù…ÛŒ (3 + 5)',
        range: { min: 1, max: 9 },
        operations: ['+', '-'],
        locked: false,
        cost: 0
    },
    easy: {
        name: 'Ø¢Ø³Ø§Ù†',
        icon: 'ðŸŸ¡',
        desc: 'ÛŒÚ© Ø±Ù‚Ù…ÛŒ Ã— ÛŒÚ© Ø±Ù‚Ù…ÛŒ (4 Ã— 7)',
        range: { min: 1, max: 9 },
        operations: ['+', '-', 'Ã—', 'Ã·'],
        locked: false,
        cost: 0
    },
    medium: {
        name: 'Ù…ØªÙˆØ³Ø·',
        icon: 'ðŸŸ ',
        desc: 'Ø¯Ùˆ Ø±Ù‚Ù…ÛŒ + ÛŒÚ© Ø±Ù‚Ù…ÛŒ (23 + 8)',
        range: { min1: 10, max1: 99, min2: 1, max2: 9 },
        locked: false,
        cost: 100
    },
    hard: {
        name: 'Ø³Ø®Øª',
        icon: 'ðŸ”´',
        desc: 'Ø¯Ùˆ Ø±Ù‚Ù…ÛŒ Ã— ÛŒÚ© Ø±Ù‚Ù…ÛŒ (45 Ã— 9)',
        range: { min1: 10, max1: 99, min2: 1, max2: 9 },
        locked: true,
        cost: 300
    },
    veryHard: {
        name: 'Ø®ÛŒÙ„ÛŒ Ø³Ø®Øª',
        icon: 'ðŸŸ£',
        desc: 'Ø¯Ùˆ Ø±Ù‚Ù…ÛŒ Ã— Ø¯Ùˆ Ø±Ù‚Ù…ÛŒ (34 Ã— 28)',
        range: { min: 10, max: 99 },
        locked: true,
        cost: 500
    },
    nightmare: {
        name: 'Ø¬Ù‡Ù†Ù…ÛŒ',
        icon: 'âš«',
        desc: 'Ø³Ù‡ Ø±Ù‚Ù…ÛŒ Ã— Ø¯Ùˆ Ø±Ù‚Ù…ÛŒ (123 Ã— 45)',
        range: { min1: 100, max1: 999, min2: 10, max2: 99 },
        locked: true,
        cost: 1000
    }
};

const medals = {
    bronze: [
        { id: 'first_flight', icon: 'ðŸŒŸ', name: 'Ø§ÙˆÙ„ÛŒÙ† Ù¾Ø±ÙˆØ§Ø²', desc: 'Ø§ÙˆÙ„ÛŒÙ† Ø¨Ø§Ø²ÛŒ', check: () => gameState.totalGames >= 1 },
        { id: 'fifty_meter', icon: 'ðŸŽ¯', name: 'Ù¾Ù†Ø¬Ø§Ù‡ Ù…ØªØ±ÛŒ', desc: '50 Ù…ØªØ± Ø§Ø±ØªÙØ§Ø¹', check: () => gameState.altitude >= 50 },
        { id: 'ten_correct', icon: 'ðŸ”¢', name: 'Ø¯Ù‡ Ø³ÙˆØ§Ù„', desc: '10 Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª', check: () => gameState.correctAnswers >= 10 }
    ],
    silver: [
        { id: 'two_hundred', icon: 'ðŸš', name: 'Ø¯ÙˆÛŒØ³Øª Ù…ØªØ±ÛŒ', desc: '200 Ù…ØªØ± Ø§Ø±ØªÙØ§Ø¹', check: () => gameState.altitude >= 200 },
        { id: 'combo_5', icon: 'ðŸ”¥', name: 'Ú©Ù…Ø¨Ùˆ 5', desc: '5 Ù¾Ø§Ø³Ø® Ù¾Ø´Øª Ø³Ø± Ù‡Ù…', check: () => gameState.combo >= 5 },
        { id: 'speed', icon: 'âš¡', name: 'Ø³Ø±Ø¹Øª', desc: '5 Ù¾Ø§Ø³Ø® Ø³Ø±ÛŒØ¹', check: () => false },
        { id: 'twenty_correct', icon: 'ðŸ’¯', name: 'Ø¨ÛŒØ³Øª Ø³ÙˆØ§Ù„', desc: '20 Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª', check: () => gameState.correctAnswers >= 20 },
        { id: 'first_buy', icon: 'ðŸ’°', name: 'Ø§ÙˆÙ„ÛŒÙ† Ø®Ø±ÛŒØ¯', desc: 'Ø®Ø±ÛŒØ¯ Ø§ÙˆÙ„ÛŒÙ† Ø¢ÛŒØªÙ…', check: () => inventory.rockets.length > 1 },
        { id: 'streak_3', icon: 'ðŸ”¥', name: 'Ø³Ù‡ Ø±ÙˆØ²', desc: '3 Ø±ÙˆØ² Ù¾Ø´Øª Ø³Ø± Ù‡Ù…', check: () => streakData.current >= 3 }
    ],
    gold: [
        { id: 'thousand_meter', icon: 'âœˆï¸', name: 'Ù‡Ø²Ø§Ø± Ù…ØªØ±ÛŒ', desc: '1000 Ù…ØªØ± Ø§Ø±ØªÙØ§Ø¹', check: () => gameState.altitude >= 1000 },
        { id: 'combo_10', icon: 'âš¡', name: 'Ú©Ù…Ø¨Ùˆ 10', desc: '10 Ù¾Ø§Ø³Ø® Ù…ØªÙˆØ§Ù„ÛŒ', check: () => gameState.combo >= 10 },
        { id: 'fifty_correct', icon: 'ðŸ’Ž', name: 'Ù¾Ù†Ø¬Ø§Ù‡ Ø³ÙˆØ§Ù„', desc: '50 Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª', check: () => gameState.correctAnswers >= 50 },
        { id: 'hard_level', icon: 'ðŸ˜Ž', name: 'Ø³Ø·Ø­ Ø³Ø®Øª', desc: 'ØªÙ…ÙˆÙ… Ú©Ø±Ø¯Ù† Ø³Ø·Ø­ Ø³Ø®Øª', check: () => false },
        { id: 'perfect', icon: 'ðŸŽ¯', name: 'Ø¯Ù‚Øª Ø¨Ø§Ù„Ø§', desc: '10 Ø³ÙˆØ§Ù„ Ø¨Ø¯ÙˆÙ† ØºÙ„Ø·', check: () => gameState.correctAnswers >= 10 && gameState.wrongAnswers === 0 },
        { id: 'streak_7', icon: 'ðŸ”¥', name: 'Ù‡ÙØª Ø±ÙˆØ²', desc: '7 Ø±ÙˆØ² Ù¾Ø´Øª Ø³Ø± Ù‡Ù…', check: () => streakData.current >= 7 }
    ],
    diamond: [
        { id: 'two_thousand', icon: 'ðŸ›¸', name: 'Ø¯Ùˆ Ù‡Ø²Ø§Ø± Ù…ØªØ±ÛŒ', desc: '2000 Ù…ØªØ±', check: () => gameState.altitude >= 2000 },
        { id: 'combo_20', icon: 'ðŸ”¥', name: 'Ú©Ù…Ø¨Ùˆ 20', desc: '20 Ù¾Ø§Ø³Ø® Ù…ØªÙˆØ§Ù„ÛŒ', check: () => gameState.combo >= 20 },
        { id: 'expert_level', icon: 'ðŸ†', name: 'Ø³Ø·Ø­ Ø§Ø³ØªØ§Ø¯', desc: 'ØªÙ…ÙˆÙ… Ú©Ø±Ø¯Ù† Ø§Ø³ØªØ§Ø¯', check: () => false },
        { id: 'hundred_correct', icon: 'ðŸ§®', name: 'ØµØ¯ Ø³ÙˆØ§Ù„', desc: '100 Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª', check: () => gameState.correctAnswers >= 100 },
        { id: 'perfect_20', icon: 'ðŸ’¯', name: 'Ú©Ø§Ù…Ù„', desc: '20 Ø³ÙˆØ§Ù„ Ø¨Ø¯ÙˆÙ† ØºÙ„Ø·', check: () => gameState.correctAnswers >= 20 && gameState.wrongAnswers === 0 },
        { id: 'lightning', icon: 'âš¡', name: 'Ø¨Ø±Ù‚ Ø¢Ø³Ø§', desc: '10 Ù¾Ø§Ø³Ø® Ø®ÛŒÙ„ÛŒ Ø³Ø±ÛŒØ¹', check: () => false },
        { id: 'streak_30', icon: 'ðŸ”¥', name: 'ÛŒÚ© Ù…Ø§Ù‡', desc: '30 Ø±ÙˆØ² Ù¾Ø´Øª Ø³Ø± Ù‡Ù…', check: () => streakData.current >= 30 }
    ],
    legend: [
        { id: 'five_thousand', icon: 'ðŸŒŸ', name: 'Ù¾Ù†Ø¬ Ù‡Ø²Ø§Ø± Ù…ØªØ±ÛŒ', desc: '5000 Ù…ØªØ±', check: () => gameState.altitude >= 5000 },
        { id: 'combo_50', icon: 'ðŸ”¥', name: 'Ú©Ù…Ø¨Ùˆ 50', desc: '50 Ù¾Ø§Ø³Ø® Ù¾Ø´Øª Ø³Ø± Ù‡Ù…!', check: () => gameState.combo >= 50 },
        { id: 'math_king', icon: 'ðŸ‘‘', name: 'Ù¾Ø§Ø¯Ø´Ø§Ù‡ Ø±ÛŒØ§Ø¶ÛŒ', desc: '500 Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª', check: () => gameState.correctAnswers >= 500 },
        { id: 'rich', icon: 'ðŸ’Ž', name: 'Ø«Ø±ÙˆØªÙ…Ù†Ø¯', desc: '10000 Ø³Ú©Ù‡ Ø¬Ù…Ø¹ Ú©Ù†', check: () => gameState.coins >= 10000 },
        { id: 'streak_100', icon: 'ðŸ”¥', name: 'ØµØ¯ Ø±ÙˆØ²!', desc: '100 Ø±ÙˆØ² Ù¾Ø´Øª Ø³Ø± Ù‡Ù…!', check: () => streakData.current >= 100 }
    ]
};

const shopItems = {
    rockets: [
        { id: 'rocket_classic', icon: 'ðŸš€', name: 'Ù…ÙˆØ´Ú© Ú©Ù„Ø§Ø³ÛŒÚ©', price: 0, owned: true },
        { id: 'plane', icon: 'âœˆï¸', name: 'Ù‡ÙˆØ§Ù¾ÛŒÙ…Ø§', price: 300, owned: false },
        { id: 'ufo', icon: 'ðŸ›¸', name: 'Ø¨Ø´Ù‚Ø§Ø¨ Ù¾Ø±Ù†Ø¯Ù‡', price: 600, owned: false },
        { id: 'helicopter', icon: 'ðŸš', name: 'Ù‡Ù„ÛŒÚ©ÙˆÙ¾ØªØ±', price: 1000, owned: false },
        { id: 'eagle', icon: 'ðŸ¦…', name: 'Ø¹Ù‚Ø§Ø¨', price: 1500, owned: false },
        { id: 'dragon', icon: 'ðŸ‰', name: 'Ø§Ú˜Ø¯Ù‡Ø§', price: 3000, owned: false },
        { id: 'comet', icon: 'ðŸŒŸ', name: 'Ø³ØªØ§Ø±Ù‡ Ø¯Ù†Ø¨Ø§Ù„Ù‡â€ŒØ¯Ø§Ø±', price: 5000, owned: false },
        { id: 'ufo_gold', icon: 'ðŸ‘½', name: 'UFO Ø·Ù„Ø§ÛŒÛŒ', price: 10000, owned: false }
    ],
    backgrounds: [
        { id: 'bg_default', icon: 'ðŸŒŒ', name: 'ÙØ¶Ø§ÛŒ Ø¹Ø§Ø¯ÛŒ', price: 0, owned: true },
        { id: 'bg_night', icon: 'ðŸŒƒ', name: 'Ø´Ø¨ Ù…Ù‡ØªØ§Ø¨ÛŒ', price: 400, owned: false },
        { id: 'bg_mars', icon: 'ðŸŒ…', name: 'ØºØ±ÙˆØ¨ Ù…Ø±ÛŒØ®', price: 800, owned: false },
        { id: 'bg_rainbow', icon: 'ðŸŒˆ', name: 'Ú©Ù‡Ú©Ø´Ø§Ù† Ø±Ù†Ú¯ÛŒ', price: 1200, owned: false },
        { id: 'bg_storm', icon: 'âš¡', name: 'Ø·ÙˆÙØ§Ù† Ø±Ø¹Ø¯ Ùˆ Ø¨Ø±Ù‚', price: 2000, owned: false },
        { id: 'bg_galaxy', icon: 'ðŸŒ ', name: 'Ø³ÙØ± Ø¨ÛŒÙ† Ú©Ù‡Ú©Ø´Ø§Ù†ÛŒ', price: 4000, owned: false }
    ],
    music: [
        { id: 'music_default', icon: 'ðŸŽ¼', name: 'Ù…ÙˆØ²ÛŒÚ© 1', price: 0, owned: true },
        { id: 'music_space', icon: 'ðŸŽµ', name: 'Ù…ÙˆØ²ÛŒÚ© ÙØ¶Ø§ÛŒÛŒ', price: 500, owned: false },
        { id: 'music_electronic', icon: 'ðŸŽ¶', name: 'Ù…ÙˆØ²ÛŒÚ© Ø§Ù„Ú©ØªØ±ÙˆÙ†ÛŒÚ©', price: 800, owned: false },
        { id: 'music_epic', icon: 'ðŸŽ¸', name: 'Ù…ÙˆØ²ÛŒÚ© Ø­Ù…Ø§Ø³ÛŒ', price: 1500, owned: false }
    ],
    effects: [
        { id: 'effect_default', icon: 'âœ¨', name: 'Ø¬Ù„ÙˆÙ‡ Ø¹Ø§Ø¯ÛŒ', price: 0, owned: true },
        { id: 'effect_gold', icon: 'âœ¨', name: 'Ø¬Ø±Ù‚Ù‡ Ø·Ù„Ø§ÛŒÛŒ', price: 700, owned: false },
        { id: 'effect_star', icon: 'ðŸŒŸ', name: 'Ø§Ù†ÙØ¬Ø§Ø± Ø³ØªØ§Ø±Ù‡', price: 1000, owned: false },
        { id: 'effect_rainbow', icon: 'ðŸ”¥', name: 'Ø¢ØªØ´ Ø±Ù†Ú¯ÛŒÙ†â€ŒÚ©Ù…Ø§Ù†', price: 2000, owned: false }
    ],
    titles: [
        { id: 'title_genius', icon: 'ðŸŒŸ', name: 'Ù†Ø§Ø¨ØºÙ‡ Ø±ÛŒØ§Ø¶ÛŒ', price: 500, owned: false },
        { id: 'title_pilot', icon: 'ðŸš€', name: 'Ø®Ù„Ø¨Ø§Ù† Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ', price: 800, owned: false },
        { id: 'title_lightning', icon: 'âš¡', name: 'Ø¨Ø±Ù‚ Ø¢Ø³Ø§', price: 1200, owned: false },
        { id: 'title_master', icon: 'ðŸ’Ž', name: 'Ø§Ø³ØªØ§Ø¯ Ø¨Ø²Ø±Ú¯', price: 2000, owned: false },
        { id: 'title_king', icon: 'ðŸ‘‘', name: 'Ù¾Ø§Ø¯Ø´Ø§Ù‡ ÙØ¶Ø§', price: 3000, owned: false },
        { id: 'title_legend', icon: 'ðŸ†', name: 'Ø§ÙØ³Ø§Ù†Ù‡', price: 5000, owned: false },
        { id: 'title_rocket_god', icon: 'ðŸ”¥', name: 'Ø®Ø¯Ø§ÛŒ Ù…ÙˆØ´Ú©', price: 10000, owned: false },
        { id: 'title_math_hero', icon: 'ðŸ¦¸', name: 'Ù‚Ù‡Ø±Ù…Ø§Ù† Ø±ÛŒØ§Ø¶ÛŒ', price: 15000, owned: false }
    ],
    powerups: [
        { id: 'powerup_time', icon: 'â°', name: 'Ø²Ù…Ø§Ù† Ø§Ø¶Ø§ÙÙ‡', price: 50, desc: '+10 Ø«Ø§Ù†ÛŒÙ‡ Ø³ÙˆØ®Øª', type: 'consumable' },
        { id: 'powerup_skip', icon: 'â­ï¸', name: 'Ø±Ø¯ Ø³ÙˆØ§Ù„', price: 30, desc: 'Ø³ÙˆØ§Ù„ Ø±Ùˆ Ø±Ø¯ Ú©Ù†', type: 'consumable' }
    ]
};

function saveGameData() {
    try {
        const saveData = {
            coins: gameState.coins,
            totalGames: gameState.totalGames,
            bestAltitude: gameState.bestAltitude,
            correctAnswers: gameState.correctAnswers,
            wrongAnswers: gameState.wrongAnswers,
            maxCombo: gameState.maxCombo,
            unlockedMedals: unlockedMedals,
            inventory: inventory,
            userSettings: userSettings,
            powerups: gameState.powerups,
            streakData: streakData,
            unlockedLevels: Object.keys(gameLevels).filter(key => !gameLevels[key].locked),
            unlockedDifficulties: Object.keys(difficultyLevels).filter(key => !difficultyLevels[key].locked)
        };
        localStorage.setItem('rocketMathGame', JSON.stringify(saveData));
    } catch (e) {
        console.warn('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡:', e);
    }
}

function loadGameData() {
    const saved = localStorage.getItem('rocketMathGame');
    if (saved) {
        try {
            const data = JSON.parse(saved);
            gameState.coins = data.coins || 0;
            gameState.totalGames = data.totalGames || 0;
            gameState.bestAltitude = data.bestAltitude || 0;
            gameState.correctAnswers = data.correctAnswers || 0;
            gameState.wrongAnswers = data.wrongAnswers || 0;
            gameState.maxCombo = data.maxCombo || 0;
            unlockedMedals = data.unlockedMedals || [];
            inventory = data.inventory || inventory;
            userSettings = data.userSettings || userSettings;
            streakData = data.streakData || streakData;
            
            if (data.powerups) {
                gameState.powerups = data.powerups;
            }
            
            if (data.unlockedLevels) {
                data.unlockedLevels.forEach(level => {
                    if (gameLevels[level]) gameLevels[level].locked = false;
                });
            }
            
            if (data.unlockedDifficulties) {
                data.unlockedDifficulties.forEach(diff => {
                    if (difficultyLevels[diff]) difficultyLevels[diff].locked = false;
                });
            }
            
            Object.keys(shopItems).forEach(category => {
                shopItems[category].forEach(item => {
                    if (inventory[category] && inventory[category].includes(item.id)) {
                        item.owned = true;
                    }
                });
            });
        } catch (e) {
            console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ:', e);
        }
    }
}

function updateStreak() {
    const today = new Date().toDateString();
    const lastPlay = streakData.lastPlayDate;
    
    if (!lastPlay) {
        streakData.current = 1;
        streakData.lastPlayDate = today;
    } else if (lastPlay === today) {
        return;
    } else {
        const lastDate = new Date(lastPlay);
        const todayDate = new Date(today);
        const diffTime = todayDate - lastDate;
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        
        if (diffDays === 1) {
            streakData.current++;
            streakData.lastPlayDate = today;
            
            if (streakData.current > streakData.best) {
                streakData.best = streakData.current;
            }
            
            const bonusCoins = streakData.current * 5;
            gameState.coins += bonusCoins;
            showFeedback('ðŸ”¥', `Ø§Ø³ØªØ±Ø§ÛŒÚ© ${streakData.current}! +${bonusCoins} Ø³Ú©Ù‡`);
        } else {
            streakData.current = 1;
            streakData.lastPlayDate = today;
        }
    }
    
    updateStreakDisplay();
    saveGameData();
}

function updateStreakDisplay() {
    document.getElementById('streakNumber').textContent = streakData.current;
    if (streakData.current === 0) {
        document.getElementById('streakBadge').style.display = 'none';
    } else {
        document.getElementById('streakBadge').style.display = 'inline-flex';
    }
}

function hideAllScreens() {
    document.querySelectorAll('.main-menu, .level-select-screen, .settings-screen, .shop-screen, .stats-screen, .medals-screen, .tutorial-screen, .game-screen').forEach(screen => {
        screen.classList.add('hidden');
    });
}

function showMainMenu() {
    hideAllScreens();
    document.getElementById('mainMenu').classList.remove('hidden');
    updateMainMenuStats();
    updateStreakDisplay();
}

function showLevelSelect() {
    hideAllScreens();
    document.getElementById('levelSelectScreen').classList.remove('hidden');
    renderLevelSelect();
}

function showSettings() {
    hideAllScreens();
    document.getElementById('settingsScreen').classList.remove('hidden');
    renderSettings();
}

function showShop() {
    hideAllScreens();
    document.getElementById('shopScreen').classList.remove('hidden');
    switchShopTab('rockets');
    updateShopBalance();
}

function showStats() {
    hideAllScreens();
    document.getElementById('statsScreen').classList.remove('hidden');
    renderStats();
}

function showMedals() {
    hideAllScreens();
    document.getElementById('medalsScreen').classList.remove('hidden');
    renderMedals();
}

function showTutorial() {
    hideAllScreens();
    document.getElementById('tutorialScreen').classList.remove('hidden');
    switchTutorialTab('multiply');
}

function backToMainMenu() {
    if (gameState.fuelTimer) {
        clearInterval(gameState.fuelTimer);
        gameState.fuelTimer = null;
    }
    gameState.isPlaying = false;
    hideCombo();
    document.getElementById('gameOverModal').classList.add('hidden');
    document.getElementById('purchaseModal').classList.add('hidden');
    document.getElementById('medalUnlockModal').classList.remove('show');
    
    const rocket = document.getElementById('rocket');
    if (rocket) rocket.style.bottom = '0px';
    
    showMainMenu();
}

function createStars() {
    const container = document.getElementById('starsContainer');
    container.innerHTML = '';
    
    const starCount = Math.min(80, Math.floor(window.innerWidth / 12));
    
    for (let i = 0; i < starCount; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.animationDelay = Math.random() * 3 + 's';
        container.appendChild(star);
    }
}

function createSpaceObjects() {
    const container = document.getElementById('spaceObjects');
    container.innerHTML = '';
    
    const objects = ['ðŸª', 'ðŸŒ', 'ðŸŒ™', 'â˜„ï¸', 'ðŸ›¸', 'ðŸ‘½', 'ðŸŒŸ', 'ðŸ’«', 'â­'];
    const count = Math.min(5, objects.length);
    
    for (let i = 0; i < count; i++) {
        const obj = document.createElement('div');
        obj.className = 'space-object';
        obj.textContent = objects[Math.floor(Math.random() * objects.length)];
        obj.style.left = Math.random() * 85 + 5 + '%';
        obj.style.top = Math.random() * 70 + 10 + '%';
        obj.style.animationDelay = Math.random() * 5 + 's';
        obj.style.animationDuration = (12 + Math.random() * 8) + 's';
        container.appendChild(obj);
    }
}

function updateMainMenuStats() {
    document.getElementById('menuCoins').textContent = gameState.coins;
    document.getElementById('menuHighscore').textContent = gameState.bestAltitude;
    document.getElementById('menuMedals').textContent = unlockedMedals.length;
}

function initAudioContext() {
    if (!audioContext) {
        try {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        } catch (e) {
            console.warn('Audio not supported');
        }
    }
}

function playBeep(frequency, duration, type = 'sine') {
    if (!gameState.soundEnabled || !audioContext) return;
    
    try {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = frequency;
        oscillator.type = type;
        
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + duration);
    } catch (e) {
        // Silent fail
    }
}

const sounds = {
    correct: () => playBeep(800, 0.1, 'sine'),
    wrong: () => playBeep(200, 0.2, 'sawtooth'),
    coin: () => playBeep(1200, 0.1, 'sine'),
    medal: () => {
        playBeep(600, 0.1, 'sine');
        setTimeout(() => playBeep(800, 0.1, 'sine'), 100);
        setTimeout(() => playBeep(1000, 0.2, 'sine'), 200);
    },
    powerup: () => playBeep(1500, 0.15, 'triangle')
};

function playSound(soundName) {
    if (sounds[soundName]) {
        sounds[soundName]();
    }
}

document.getElementById('soundToggle').onclick = function() {
    gameState.soundEnabled = !gameState.soundEnabled;
    this.textContent = gameState.soundEnabled ? 'ðŸ”Š' : 'ðŸ”‡';
    this.classList.toggle('muted');
    playSound('coin');
};

document.getElementById('fullscreenToggle').onclick = function() {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
            console.log('Fullscreen error:', err);
        });
        this.textContent = 'â›¶';
    } else {
        document.exitFullscreen();
        this.textContent = 'â›¶';
    }
};

function renderLevelSelect() {
    const container = document.getElementById('levelGrid');
    container.innerHTML = '';
    
    Object.keys(gameLevels).forEach(key => {
        const level = gameLevels[key];
        const card = document.createElement('div');
        card.className = `level-card ${key}`;
        if (level.locked) card.classList.add('locked');
        
        card.innerHTML = `
            <div class="level-card-icon">${level.icon}</div>
            <div class="level-card-name">${level.name}</div>
            <div class="level-card-desc">${level.desc}</div>
            <div class="level-card-reward">Ø³Ú©Ù‡: ${level.coinMultiplier}Ã—</div>
        `;
        
        card.onclick = () => {
            if (level.locked) {
                if (gameState.coins >= level.unlockCost) {
                    if (confirm(`Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø³Ø·Ø­ ${level.name} Ø¨Ø§ ${level.unlockCost} Ø³Ú©Ù‡ØŸ`)) {
                        gameState.coins -= level.unlockCost;
                        level.locked = false;
                        saveGameData();
                        renderLevelSelect();
                        playSound('coin');
                    }
                } else {
                    showFeedback('âŒ', 'Ø³Ú©Ù‡ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒ!');
                }
            } else {
                startGame(key);
            }
        };
        
        container.appendChild(card);
    });
}

function renderSettings() {
    const opsContainer = document.getElementById('operationsCheckbox');
    opsContainer.innerHTML = '';
    
    const operations = [
        { id: '+', icon: 'âž•', label: 'Ø¬Ù…Ø¹', price: 0, locked: false },
        { id: '-', icon: 'âž–', label: 'ØªÙØ±ÛŒÙ‚', price: 0, locked: false },
        { id: 'Ã—', icon: 'âœ–ï¸', label: 'Ø¶Ø±Ø¨', price: 0, locked: false },
        { id: 'Ã·', icon: 'âž—', label: 'ØªÙ‚Ø³ÛŒÙ…', price: 0, locked: false }
    ];
    
    operations.forEach(op => {
        const isChecked = userSettings.operations.includes(op.id);
        const div = document.createElement('div');
        div.className = `checkbox-item ${isChecked ? 'checked' : ''} ${op.locked ? 'locked' : ''}`;
        div.innerHTML = `
            <div class="checkbox-icon">${op.icon}</div>
            <div class="checkbox-label">${op.label}</div>
        `;
        
        div.onclick = () => {
            if (!op.locked) {
                if (isChecked) {
                    if (userSettings.operations.length > 1) {
                        userSettings.operations = userSettings.operations.filter(o => o !== op.id);
                        renderSettings();
                    }
                } else {
                    userSettings.operations.push(op.id);
                    renderSettings();
                }
            }
        };
        
        opsContainer.appendChild(div);
    });
    
    const diffContainer = document.getElementById('difficultyRadio');
    diffContainer.innerHTML = '';
    
    Object.keys(difficultyLevels).forEach(key => {
        const diff = difficultyLevels[key];
        const isSelected = userSettings.difficulty === key;
        const div = document.createElement('div');
        div.className = `radio-item ${isSelected ? 'selected' : ''}`;
        
        const lockText = diff.locked ? ` (${diff.cost} Ø³Ú©Ù‡)` : '';
        
        div.innerHTML = `
            <div class="radio-circle"></div>
            <div class="radio-content">
                <div class="radio-title">${diff.icon} ${diff.name}${lockText}</div>
                <div class="radio-desc">${diff.desc}</div>
            </div>
        `;
        
        div.onclick = () => {
            if (!diff.locked) {
                userSettings.difficulty = key;
                renderSettings();
            } else if (gameState.coins >= diff.cost) {
                if (confirm(`Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø³Ø·Ø­ ${diff.name} Ø¨Ø§ ${diff.cost} Ø³Ú©Ù‡ØŸ`)) {
                    gameState.coins -= diff.cost;
                    diff.locked = false;
                    userSettings.difficulty = key;
                    saveGameData();
                    renderSettings();
                    playSound('coin');
                }
            } else {
                showFeedback('âŒ', 'Ø³Ú©Ù‡ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒ!');
            }
        };
        
        diffContainer.appendChild(div);
    });
}

function saveSettings() {
    saveGameData();
    showFeedback('âœ…', 'ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!');
    setTimeout(() => showLevelSelect(), 1000);
}

let currentShopTab = 'rockets';
let selectedShopItem = null;

function switchShopTab(tab) {
    currentShopTab = tab;
    document.querySelectorAll('.shop-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    renderShopItems(tab);
}

function renderShopItems(category) {
    const container = document.getElementById('shopItems');
    container.innerHTML = '';
    
    if (category === 'powerups') {
        shopItems.powerups.forEach(item => {
            const card = document.createElement('div');
            card.className = 'shop-item';
            
            card.innerHTML = `
                <div class="shop-item-icon">${item.icon}</div>
                <div class="shop-item-name">${item.name}</div>
                <div style="font-size: 11px; color: #7f8c8d; margin: 5px 0;">${item.desc}</div>
                <div class="shop-item-price">ðŸ’° ${item.price}</div>
            `;
            
            card.onclick = () => {
                if (gameState.coins >= item.price) {
                    if (confirm(`Ø®Ø±ÛŒØ¯ ${item.name} Ø¨Ø§ ${item.price} Ø³Ú©Ù‡?`)) {
                        gameState.coins -= item.price;
                        
                        if (item.id === 'powerup_time') {
                            gameState.powerups.timeBoost++;
                        } else if (item.id === 'powerup_skip') {
                            gameState.powerups.skipQuestion++;
                        }
                        
                        saveGameData();
                        updateShopBalance();
                        showFeedback('âœ…', 'Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯!');
                        playSound('coin');
                    }
                } else {
                    showFeedback('âŒ', 'Ø³Ú©Ù‡ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒ!');
                }
            };
            
            container.appendChild(card);
        });
        return;
    }
    
    if (category === 'titles') {
        shopItems.titles.forEach(item => {
            const isOwned = inventory.titles.includes(item.id);
            const isEquipped = userSettings.equippedTitle === item.id;
            
            const card = document.createElement('div');
            card.className = `shop-item ${isOwned ? 'owned' : ''} ${isEquipped ? 'equipped' : ''} ${!isOwned && item.price > gameState.coins ? 'locked' : ''}`;
            
            let badge = '';
            if (isEquipped) badge = '<div class="shop-item-badge">Ø¯Ø± Ø­Ø§Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡</div>';
            else if (isOwned) badge = '<div class="shop-item-badge">Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡</div>';
            
            card.innerHTML = `
                ${!isOwned ? '<div class="shop-item-lock">ðŸ”’</div>' : ''}
                ${badge}
                <div class="shop-item-icon">${item.icon}</div>
                <div class="shop-item-name">${item.name}</div>
                <div class="shop-item-price">${isOwned ? (isEquipped ? 'âœ” Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡' : 'Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†') : 'ðŸ’° ' + item.price}</div>
            `;
            
            card.onclick = () => {
                if (isOwned && !isEquipped) {
                    userSettings.equippedTitle = item.id;
                    saveGameData();
                    renderShopItems(category);
                    showFeedback('âœ…', 'Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯!');
                    playSound('coin');
                } else if (!isOwned) {
                    openPurchaseModal(item, category);
                }
            };
            
            container.appendChild(card);
        });
        return;
    }
    
    const categoryMap = {
        'rockets': 'rockets',
        'backgrounds': 'backgrounds',
        'music': 'music',
        'effects': 'effects'
    };
    
    const items = shopItems[categoryMap[category]];
    
    items.forEach(item => {
        const isOwned = item.owned;
        const settingKey = category === 'rockets' ? 'equippedRocket' : 
                          category === 'backgrounds' ? 'equippedBackground' :
                          category === 'music' ? 'equippedMusic' : 'equippedEffect';
        const isEquipped = userSettings[settingKey] === item.id;
        
        const card = document.createElement('div');
        card.className = `shop-item ${isOwned ? 'owned' : ''} ${isEquipped ? 'equipped' : ''} ${!isOwned && item.price > gameState.coins ? 'locked' : ''}`;
        
        let badge = '';
        if (isEquipped) badge = '<div class="shop-item-badge">Ø¯Ø± Ø­Ø§Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡</div>';
        else if (isOwned) badge = '<div class="shop-item-badge">Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡</div>';
        
        card.innerHTML = `
            ${!isOwned ? '<div class="shop-item-lock">ðŸ”’</div>' : ''}
            ${badge}
            <div class="shop-item-icon">${item.icon}</div>
            <div class="shop-item-name">${item.name}</div>
            <div class="shop-item-price">${isOwned ? (isEquipped ? 'âœ” Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡' : 'Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†') : 'ðŸ’° ' + item.price}</div>
        `;
        
        card.onclick = () => {
            if (isOwned && !isEquipped) {
                userSettings[settingKey] = item.id;
                saveGameData();
                renderShopItems(category);
                showFeedback('âœ…', 'Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯!');
                playSound('coin');
            } else if (!isOwned) {
                openPurchaseModal(item, category);
            }
        };
        
        container.appendChild(card);
    });
}

function updateShopBalance() {
    document.getElementById('shopCoins').textContent = gameState.coins;
}

function openPurchaseModal(item, category) {
    if (gameState.coins < item.price) {
        showFeedback('âŒ', 'Ø³Ú©Ù‡ Ú©Ø§ÙÛŒ Ù†Ø¯Ø§Ø±ÛŒ!');
        return;
    }
    
    selectedShopItem = { item, category };
    document.getElementById('purchaseIcon').textContent = item.icon;
    document.getElementById('purchaseTitle').textContent = item.name;
    document.getElementById('purchaseDesc').textContent = `Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒ Ø§ÛŒÙ† Ø¢ÛŒØªÙ… Ø±Ùˆ Ø¨Ø®Ø±ÛŒØŸ`;
    document.getElementById('purchasePrice').textContent = `ðŸ’° ${item.price}`;
    document.getElementById('purchaseModal').classList.remove('hidden');
    
    document.getElementById('confirmPurchaseBtn').onclick = confirmPurchase;
}

function closePurchaseModal() {
    document.getElementById('purchaseModal').classList.add('hidden');
    selectedShopItem = null;
}

function confirmPurchase() {
    if (!selectedShopItem) return;
    
    const { item, category } = selectedShopItem;
    
    if (gameState.coins >= item.price) {
        gameState.coins -= item.price;
        item.owned = true;
        
        if (category === 'titles') {
            inventory.titles.push(item.id);
        } else {
            const categoryMap = {
                'rockets': 'rockets',
                'backgrounds': 'backgrounds',
                'music': 'music',
                'effects': 'effects'
            };
            
            inventory[categoryMap[category]].push(item.id);
        }
        
        saveGameData();
        updateShopBalance();
        closePurchaseModal();
        renderShopItems(category);
        
        showFeedback('ðŸŽ‰', 'Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯!');
        playSound('coin');
        checkMedals();
    }
}

function renderStats() {
    document.getElementById('totalGames').textContent = gameState.totalGames;
    document.getElementById('totalCorrect').textContent = gameState.correctAnswers;
    document.getElementById('totalWrong').textContent = gameState.wrongAnswers;
    document.getElementById('bestAltitude').textContent = gameState.bestAltitude;
    document.getElementById('totalCoins').textContent = gameState.coins;
    document.getElementById('totalMedalsCount').textContent = unlockedMedals.length;
    document.getElementById('bestCombo').textContent = gameState.maxCombo;
    document.getElementById('currentStreak').textContent = streakData.current;
    
    const total = gameState.correctAnswers + gameState.wrongAnswers;
    const successRate = total > 0 ? Math.round((gameState.correctAnswers / total) * 100) : 0;
    
    document.getElementById('successRate').style.width = successRate + '%';
    document.getElementById('successRate').textContent = successRate + '%';
    
    updateRank();
}

function updateRank() {
    const altitude = gameState.bestAltitude;
    let rank = { icon: 'ðŸ¥‰', name: 'Ù…Ø¨ØªØ¯ÛŒ' };
    
    if (altitude >= 5000) rank = { icon: 'ðŸ‘‘', name: 'Ø§ÙØ³Ø§Ù†Ù‡' };
    else if (altitude >= 3000) rank = { icon: 'ðŸ’Ž', name: 'Ø§Ø³ØªØ§Ø¯' };
    else if (altitude >= 1500) rank = { icon: 'ðŸ¥‡', name: 'Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ' };
    else if (altitude >= 500) rank = { icon: 'ðŸ¥ˆ', name: 'Ù…Ø§Ù‡Ø±' };
    
    document.getElementById('rankIcon').textContent = rank.icon;
    document.getElementById('rankName').textContent = rank.name;
}

function renderMedals() {
    const container = document.getElementById('medalsContent');
    container.innerHTML = '';
    
    const categories = [
        { key: 'bronze', name: 'ðŸ¥‰ Ø¨Ø±Ù†Ø²', color: '#cd7f32' },
        { key: 'silver', name: 'ðŸ¥ˆ Ù†Ù‚Ø±Ù‡', color: '#c0c0c0' },
        { key: 'gold', name: 'ðŸ¥‡ Ø·Ù„Ø§', color: '#ffd700' },
        { key: 'diamond', name: 'ðŸ’Ž Ø§Ù„Ù…Ø§Ø³', color: '#b9f2ff' },
        { key: 'legend', name: 'ðŸ‘‘ Ø§ÙØ³Ø§Ù†Ù‡', color: '#ff00ff' }
    ];
    
    categories.forEach(cat => {
        const section = document.createElement('div');
        section.className = 'medals-category';
        
        section.innerHTML = `
            <div class="medals-category-title" style="border-right: 5px solid ${cat.color}">
                ${cat.name}
            </div>
            <div class="medals-grid" id="medals-${cat.key}"></div>
        `;
        
        container.appendChild(section);
        
        const grid = document.getElementById(`medals-${cat.key}`);
        medals[cat.key].forEach(medal => {
            const isUnlocked = unlockedMedals.includes(medal.id);
            const card = document.createElement('div');
            card.className = `medal-card ${isUnlocked ? 'unlocked' : 'locked'}`;
            
            card.innerHTML = `
                <div class="medal-card-icon">${medal.icon}</div>
                <div class="medal-card-name">${medal.name}</div>
                <div class="medal-card-desc">${isUnlocked ? medal.desc : 'ðŸ”’ Ù…Ø®ÙÛŒ'}</div>
            `;
            
            grid.appendChild(card);
        });
    });
}

function checkMedals() {
    newMedalsThisGame = [];
    
    Object.keys(medals).forEach(category => {
        medals[category].forEach(medal => {
            if (!unlockedMedals.includes(medal.id)) {
                try {
                    if (medal.check()) {
                        unlockedMedals.push(medal.id);
                        newMedalsThisGame.push(medal);
                        showMedalUnlock(medal);
                        playSound('medal');
                    }
                } catch (e) {
                    // Medal check failed
                }
            }
        });
    });
    
    if (newMedalsThisGame.length > 0) {
        saveGameData();
    }
}

function showMedalUnlock(medal) {
    const modal = document.getElementById('medalUnlockModal');
    document.getElementById('medalUnlockIcon').textContent = medal.icon;
    document.getElementById('medalUnlockTitle').textContent = medal.name;
    document.getElementById('medalUnlockDesc').textContent = medal.desc;
    
    modal.classList.add('show');
    setTimeout(() => modal.classList.remove('show'), 3000);
}

function closeMedalUnlock() {
    document.getElementById('medalUnlockModal').classList.remove('show');
}

let currentTutorialTab = 'multiply';

function switchTutorialTab(tab) {
    currentTutorialTab = tab;
    document.querySelectorAll('.tutorial-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    renderTutorial(tab);
}

function renderTutorial(tab) {
    const container = document.getElementById('tutorialContent');
    
    if (tab === 'multiply') {
        let html = '<h3 style="text-align: center; margin-bottom: 20px;">Ø¬Ø¯ÙˆÙ„ Ø¶Ø±Ø¨</h3>';
        html += '<div class="multiplication-table">';
        
        for (let i = 1; i <= 10; i++) {
            for (let j = 1; j <= 10; j++) {
                html += `
                    <div class="table-item">
                        <div class="table-item-question ltr-content">${i} Ã— ${j}</div>
                        <div class="table-item-answer">${i * j}</div>
                    </div>
                `;
            }
        }
        
        html += '</div>';
        container.innerHTML = html;
    } else if (tab === 'tips') {
        container.innerHTML = `
            <h3 style="text-align: center; margin-bottom: 20px;">ðŸ’¡ Ù†Ú©Ø§Øª Ø±ÛŒØ§Ø¶ÛŒ</h3>
            <ul class="tips-list">
                <li class="tip-item">
                    <span class="tip-icon">âœ–ï¸</span>
                    <span class="tip-text">Ø¨Ø±Ø§ÛŒ Ø¶Ø±Ø¨ Ø¯Ø± 5: Ø¹Ø¯Ø¯ Ø±Ùˆ Ø¶Ø±Ø¨ 10 Ú©Ù† Ùˆ Ø¨Ø¹Ø¯ Ù†ØµÙØ´ Ú©Ù†</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">âœ–ï¸</span>
                    <span class="tip-text">Ø¨Ø±Ø§ÛŒ Ø¶Ø±Ø¨ Ø¯Ø± 9: Ø¹Ø¯Ø¯ Ø±Ùˆ Ø¶Ø±Ø¨ 10 Ú©Ù† Ùˆ Ø¨Ø¹Ø¯ Ø®ÙˆØ¯Ø´ Ø±Ùˆ Ø§Ø²Ø´ Ú©Ù… Ú©Ù†</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">âœ–ï¸</span>
                    <span class="tip-text">Ø¨Ø±Ø§ÛŒ Ø¶Ø±Ø¨ Ø¯Ø± 11: Ø¹Ø¯Ø¯ Ø±Ùˆ Ø¯Ùˆ Ø¨Ø§Ø± Ú©Ù†Ø§Ø± Ù‡Ù… Ø¨Ù†ÙˆÛŒØ³ (Ù…Ø«Ù„Ø§ 23 Ã— 11 = 253)</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">âž•</span>
                    <span class="tip-text">Ø¨Ø±Ø§ÛŒ Ø¬Ù…Ø¹ Ø§Ø¹Ø¯Ø§Ø¯ Ù†Ø²Ø¯ÛŒÚ©: ÛŒÚ©ÛŒ Ø±Ùˆ Ú¯Ø±Ø¯ Ú©Ù† Ùˆ ØªÙØ§ÙˆØª Ø±Ùˆ Ø§Ø¶Ø§ÙÙ‡/Ú©Ù… Ú©Ù†</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">âž–</span>
                    <span class="tip-text">Ø¨Ø±Ø§ÛŒ ØªÙØ±ÛŒÙ‚: Ø§Ú¯Ø± Ø³Ø®ØªÙ‡ØŒ Ù‡Ø± Ø¯Ùˆ Ø·Ø±Ù Ø±Ùˆ Ø¨Ø§ ÛŒÚ© Ø¹Ø¯Ø¯ ØªØºÛŒÛŒØ± Ø¨Ø¯Ù‡</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">âž—</span>
                    <span class="tip-text">Ø¨Ø±Ø§ÛŒ ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± 2: Ù†ØµÙ Ú©Ù†. Ø¨Ø±Ø§ÛŒ ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± 4: Ø¯Ùˆ Ø¨Ø§Ø± Ù†ØµÙ Ú©Ù†</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">ðŸŽ¯</span>
                    <span class="tip-text">Ø¨Ø±Ø§ÛŒ Ø¶Ø±Ø¨ Ø¯Ø± 25: Ø¹Ø¯Ø¯ Ø±Ùˆ ØªÙ‚Ø³ÛŒÙ… Ø¨Ø± 4 Ú©Ù† Ùˆ Ø¨Ø¹Ø¯ Ø¶Ø±Ø¨ Ø¯Ø± 100</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">ðŸ§ </span>
                    <span class="tip-text">Ø¨Ø±Ø§ÛŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø³Ø±ÛŒØ¹: Ø§Ø¹Ø¯Ø§Ø¯ Ø±Ùˆ Ø¨Ù‡ Ø§Ø¬Ø²Ø§ÛŒ Ú©ÙˆÚ†Ú©â€ŒØªØ± ØªØ¨Ø¯ÛŒÙ„ Ú©Ù†</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">ðŸ’¡</span>
                    <span class="tip-text">Ø¬Ø¯ÙˆÙ„ Ø¶Ø±Ø¨ 2ØŒ 5ØŒ 10 Ø±Ùˆ Ø­ÙØ¸ Ú©Ù† - Ø¨Ù‚ÛŒÙ‡ Ø±Ùˆ Ø§Ø² Ø§ÙˆÙ†Ø§ Ø¨Ø³Ø§Ø²</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">âš¡</span>
                    <span class="tip-text">ØªÙ…Ø±ÛŒÙ† Ø²ÛŒØ§Ø¯ Ú©Ù„ÛŒØ¯ Ù…ÙˆÙÙ‚ÛŒØªÙ‡! Ù‡Ø± Ø±ÙˆØ² Ú†Ù†Ø¯ Ø¯Ù‚ÛŒÙ‚Ù‡ ØªÙ…Ø±ÛŒÙ† Ú©Ù†</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">ðŸŽ¯</span>
                    <span class="tip-text">Ø§ÙˆÙ„ ØµØ­ØªØŒ Ø¨Ø¹Ø¯ Ø³Ø±Ø¹Øª! Ø¯Ù‚Øª Ù…Ù‡Ù…â€ŒØªØ± Ø§Ø² ØªÙ†Ø¯ Ø¨ÙˆØ¯Ù† Ø§Ø³Øª</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">ðŸ”¥</span>
                    <span class="tip-text">Ø§Ø² Ù¾Ø§ÙˆØ±Ø§Ù¾â€ŒÙ‡Ø§ Ø¯Ø± Ù„Ø­Ø¸Ø§Øª Ø³Ø®Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†!</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">ðŸ“</span>
                    <span class="tip-text">Ø¨Ø±Ø§ÛŒ Ø¶Ø±Ø¨ Ø¯Ø± 12: Ø§ÙˆÙ„ Ø¯Ø± 10 Ø¶Ø±Ø¨ Ú©Ù†ØŒ Ø¨Ø¹Ø¯ Ø¯Ùˆ Ø¨Ø±Ø§Ø¨Ø±Ø´ Ø±Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">ðŸŽ¨</span>
                    <span class="tip-text">Ø§Ø² Ø§Ù„Ú¯ÙˆÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†: Ù…Ø«Ù„Ø§ 6Ã—8 = 6Ã—10 - 6Ã—2 = 48</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">ðŸŽª</span>
                    <span class="tip-text">Ù…Ø±Ø¨Ø¹ Ø§Ø¹Ø¯Ø§Ø¯ Ø±Ùˆ ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ±: 1ØŒ 4ØŒ 9ØŒ 16ØŒ 25ØŒ 36ØŒ 49ØŒ 64ØŒ 81ØŒ 100</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">ðŸŒŸ</span>
                    <span class="tip-text">Ø§Ø³ØªØ±Ø§ÛŒÚ© Ø±ÙˆØ²Ø§Ù†Ù‡ Ø­ÙØ¸ Ú©Ù† ØªØ§ Ø³Ú©Ù‡ Ø¨ÛŒØ´ØªØ±ÛŒ Ø¨Ú¯ÛŒØ±ÛŒ!</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">ðŸ†</span>
                    <span class="tip-text">Ø¨Ø§ Ø¯ÙˆØ³ØªØ§Øª Ø±Ù‚Ø§Ø¨Øª Ú©Ù† - ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ú¯Ø±ÙˆÙ‡ÛŒ Ø¨Ù‡ØªØ±Ù‡!</span>
                </li>
                <li class="tip-item">
                    <span class="tip-icon">ðŸ§©</span>
                    <span class="tip-text">Ø§Ú¯Ù‡ Ú¯ÛŒØ± Ú©Ø±Ø¯ÛŒØŒ Ø¹Ø¯Ø¯ Ø±Ùˆ Ø¨Ù‡ Ø§Ø¬Ø²Ø§ÛŒ Ø³Ø§Ø¯Ù‡â€ŒØªØ± ØªÙ‚Ø³ÛŒÙ… Ú©Ù†</span>
                </li>
            </ul>
        `;
    } else if (tab === 'guide') {
        container.innerHTML = `
            <h3 style="text-align: center; margin-bottom: 20px;">ðŸ“– Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨Ø§Ø²ÛŒ</h3>
            <div style="background: white; padding: 20px; border-radius: 15px;">
                <h4 style="color: #3498db; margin-bottom: 10px;">ðŸŽ® Ú†Ø·ÙˆØ± Ø¨Ø§Ø²ÛŒ Ú©Ù†Ù…ØŸ</h4>
                <p style="margin-bottom: 15px; line-height: 1.6;">1. ÛŒÚ© Ø³Ø·Ø­ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù† (Ø¹Ø§Ø¯ÛŒØŒ Ø´Ø¨ØŒ Ú†Ø§Ù„Ø´ Ùˆ...)</p>
                <p style="margin-bottom: 15px; line-height: 1.6;">2. Ø¨Ù‡ Ø³ÙˆØ§Ù„Ø§Øª Ø±ÛŒØ§Ø¶ÛŒ Ù¾Ø§Ø³Ø® Ø¨Ø¯Ù‡</p>
                <p style="margin-bottom: 15px; line-height: 1.6;">3. Ø¨Ø§ Ù‡Ø± Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª Ø³ÙˆØ®Øª Ù…ÙˆØ´Ú© Ù¾Ø± Ù…ÛŒØ´Ù‡</p>
                <p style="margin-bottom: 15px; line-height: 1.6;">4. Ø¨Ø§ Ù¾Ø§Ø³Ø® ØºÙ„Ø· Ø¸Ø±ÙÛŒØª Ù…Ø®Ø²Ù† Ú©Ù… Ù…ÛŒØ´Ù‡</p>
                
                <h4 style="color: #3498db; margin: 20px 0 10px;">ðŸ’° Ø³Ú©Ù‡ Ú†Ø·ÙˆØ± Ø¨Ú¯ÛŒØ±Ù…ØŸ</h4>
                <p style="margin-bottom: 15px; line-height: 1.6;">- Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª: 5 Ø³Ú©Ù‡</p>
                <p style="margin-bottom: 15px; line-height: 1.6;">- Ù¾Ø§Ø³Ø® Ø³Ø±ÛŒØ¹: 10 Ø³Ú©Ù‡</p>
                <p style="margin-bottom: 15px; line-height: 1.6;">- Ú©Ù…Ø¨Ùˆ: Ø¨ÙˆÙ†ÙˆØ³ Ø§Ø¶Ø§ÙÛŒ</p>
                <p style="margin-bottom: 15px; line-height: 1.6;">- Ø±Ú©ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯: 100 Ø³Ú©Ù‡</p>
                
                <h4 style="color: #3498db; margin: 20px 0 10px;">âš¡ Ù¾Ø§ÙˆØ±Ø§Ù¾â€ŒÙ‡Ø§</h4>
                <p style="margin-bottom: 15px; line-height: 1.6;">- â° Ø²Ù…Ø§Ù† Ø§Ø¶Ø§ÙÙ‡: +10 Ø«Ø§Ù†ÛŒÙ‡ Ø³ÙˆØ®Øª</p>
                <p style="margin-bottom: 15px; line-height: 1.6;">- â­ï¸ Ø±Ø¯ Ø³ÙˆØ§Ù„: Ø³ÙˆØ§Ù„ Ø±Ùˆ Ø±Ø¯ Ú©Ù†</p>
                <p style="margin-bottom: 15px; line-height: 1.6;">- Ù…ÛŒØªÙˆÙ†ÛŒ Ø§Ø² ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø¨Ø®Ø±ÛŒ!</p>
                
                <h4 style="color: #3498db; margin: 20px 0 10px;">ðŸ”¥ Ø§Ø³ØªØ±Ø§ÛŒÚ©</h4>
                <p style="margin-bottom: 15px; line-height: 1.6;">Ù‡Ø± Ø±ÙˆØ² Ø¨Ø§Ø²ÛŒ Ú©Ù† ØªØ§ Ø§Ø³ØªØ±Ø§ÛŒÚ© Ø¨Ø§Ù„Ø§ Ø¨Ø±Ù‡ Ùˆ Ø³Ú©Ù‡ Ø¨ÙˆÙ†ÙˆØ³ Ø¨Ú¯ÛŒØ±ÛŒ!</p>
                
                <h4 style="color: #3498db; margin: 20px 0 10px;">ðŸ‘‘ Ù„Ù‚Ø¨â€ŒÙ‡Ø§</h4>
                <p style="margin-bottom: 15px; line-height: 1.6;">Ø§Ø² ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ù„Ù‚Ø¨â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø¨Ø®Ø± Ùˆ Ø®ÙˆØ¯Øª Ø±Ùˆ Ù†Ø´ÙˆÙ† Ø¨Ø¯Ù‡!</p>
            </div>
        `;
    }
}

function startGame(levelKey) {
    gameState.currentLevel = levelKey;
    const level = gameLevels[levelKey];
    
    gameState.score = 0;
    gameState.altitude = 0;
    gameState.fuel = level.initialFuel;
    gameState.maxFuel = level.initialFuel;
    gameState.combo = 0;
    gameState.correctAnswers = 0;
    gameState.wrongAnswers = 0;
    gameState.isPlaying = true;
    newMedalsThisGame = [];
    
    updateStreak();
    
    hideAllScreens();
    document.getElementById('gameScreen').classList.remove('hidden');
    
    const rocketIcon = shopItems.rockets.find(r => r.id === userSettings.equippedRocket)?.icon || 'ðŸš€';
    document.getElementById('rocket').innerHTML = `
        ${rocketIcon}
        <div class="rocket-fire">ðŸ”¥</div>
    `;
    
    document.getElementById('levelBadge').textContent = level.name + ' ' + level.icon;
    document.getElementById('levelBadge').style.background = level.color;
    
    updateGameUI();
    createSpaceObjects();
    renderPowerups();
    startFuelTimer();
    generateQuestion();
    
    setTimeout(() => {
        document.getElementById('answerInput').focus();
    }, 100);
}

function renderPowerups() {
    const container = document.getElementById('powerupsContainer');
    container.innerHTML = '';
    
    if (gameState.powerups.timeBoost > 0) {
        const btn = document.createElement('button');
        btn.className = 'powerup-btn';
        btn.innerHTML = `<span class="powerup-icon">â°</span> Ø²Ù…Ø§Ù† +10 (${gameState.powerups.timeBoost})`;
        btn.onclick = usePowerupTime;
        container.appendChild(btn);
    }
    
    if (gameState.powerups.skipQuestion > 0) {
        const btn = document.createElement('button');
        btn.className = 'powerup-btn';
        btn.innerHTML = `<span class="powerup-icon">â­ï¸</span> Ø±Ø¯ Ø³ÙˆØ§Ù„ (${gameState.powerups.skipQuestion})`;
        btn.onclick = usePowerupSkip;
        container.appendChild(btn);
    }
}

function usePowerupTime() {
    if (gameState.powerups.timeBoost > 0 && gameState.isPlaying) {
        gameState.powerups.timeBoost--;
        gameState.fuel = Math.min(gameState.fuel + 10, gameState.maxFuel);
        updateGameUI();
        renderPowerups();
        showFeedback('â°', '+10 Ø«Ø§Ù†ÛŒÙ‡!');
        playSound('powerup');
        saveGameData();
    }
}

function usePowerupSkip() {
    if (gameState.powerups.skipQuestion > 0 && gameState.isPlaying) {
        gameState.powerups.skipQuestion--;
        generateQuestion();
        renderPowerups();
        showFeedback('â­ï¸', 'Ø³ÙˆØ§Ù„ Ø±Ø¯ Ø´Ø¯!');
        playSound('powerup');
        saveGameData();
    }
}

function generateQuestion() {
    const operations = userSettings.operations;
    const operation = operations[Math.floor(Math.random() * operations.length)];
    const difficulty = difficultyLevels[userSettings.difficulty];
    
    let num1, num2, answer;
    
    if (userSettings.difficulty === 'veryEasy' || userSettings.difficulty === 'easy') {
        num1 = Math.floor(Math.random() * 9) + 1;
        num2 = Math.floor(Math.random() * 9) + 1;
        
        if (operation === '+') {
            answer = num1 + num2;
        } else if (operation === '-') {
            if (num1 < num2) [num1, num2] = [num2, num1];
            answer = num1 - num2;
        } else if (operation === 'Ã—') {
            answer = num1 * num2;
        } else if (operation === 'Ã·') {
            answer = num1;
            num1 = num1 * num2;
        }
    } else if (userSettings.difficulty === 'medium') {
        num1 = Math.floor(Math.random() * 90) + 10;
        num2 = Math.floor(Math.random() * 9) + 1;
        
        if (operation === '+') {
            answer = num1 + num2;
        } else if (operation === '-') {
            answer = num1 - num2;
        } else if (operation === 'Ã—') {
            answer = num1 * num2;
        } else if (operation === 'Ã·') {
            answer = num2;
            const temp = num1;
            num1 = temp * num2;
            num2 = temp;
        }
    } else {
        num1 = Math.floor(Math.random() * 90) + 10;
        num2 = Math.floor(Math.random() * 90) + 10;
        
        if (operation === '+') {
            answer = num1 + num2;
        } else if (operation === '-') {
            if (num1 < num2) [num1, num2] = [num2, num1];
            answer = num1 - num2;
        } else if (operation === 'Ã—') {
            answer = num1 * num2;
        } else if (operation === 'Ã·') {
            answer = Math.floor(num1 / num2);
            num1 = answer * num2;
        }
    }
    
    gameState.currentQuestion = { num1, num2, operation, answer };
    document.getElementById('questionText').textContent = `${num1} ${operation} ${num2} = ?`;
    document.getElementById('answerInput').value = '';
    document.getElementById('answerInput').classList.remove('correct', 'wrong');
    
    const submitBtn = document.getElementById('submitButton');
    submitBtn.disabled = true;
    
    document.getElementById('answerInput').oninput = function() {
        submitBtn.disabled = this.value.trim() === '';
    };
}

function submitAnswer() {
    const input = document.getElementById('answerInput');
    let inputValue = input.value;
    
    const persianNumbers = ['Û°', 'Û±', 'Û²', 'Û³', 'Û´', 'Ûµ', 'Û¶', 'Û·', 'Û¸', 'Û¹'];
    const arabicNumbers = ['Ù ', 'Ù¡', 'Ù¢', 'Ù£', 'Ù¤', 'Ù¥', 'Ù¦', 'Ù§', 'Ù¨', 'Ù©'];
    
    for (let i = 0; i < 10; i++) {
        inputValue = inputValue.replace(new RegExp(persianNumbers[i], 'g'), i.toString());
        inputValue = inputValue.replace(new RegExp(arabicNumbers[i], 'g'), i.toString());
    }
    
    const userAnswer = parseInt(inputValue);
    
    if (isNaN(userAnswer) || input.value === '') {
        input.classList.add('shake');
        setTimeout(() => input.classList.remove('shake'), 500);
        return;
    }
    
    const level = gameLevels[gameState.currentLevel];
    const isCorrect = userAnswer === gameState.currentQuestion.answer;
    
    if (isCorrect) {
        input.classList.add('correct');
        handleCorrectAnswer(level);
    } else {
        input.classList.add('wrong');
        handleWrongAnswer(level);
    }
    
    checkMedals();
    updateGameUI();
    
    setTimeout(() => {
        generateQuestion();
        input.classList.remove('correct', 'wrong');
    }, 300);
}

function handleCorrectAnswer(level) {
    showFeedback('âœ…');
    playSound('correct');
    
    const baseScore = 10;
    const comboBonus = gameState.combo * 2;
    gameState.score += baseScore + comboBonus;
    
    let coinReward = 5;
    if (gameState.combo >= 5) coinReward = 10;
    coinReward = Math.floor(coinReward * level.coinMultiplier);
    gameState.coins += coinReward;
    
    createCoinAnimation(coinReward);
    
    gameState.altitude += 100;
    updateRocketPosition();
    
    gameState.fuel = Math.min(gameState.fuel + level.fuelBonus, gameState.maxFuel);
    
    gameState.combo++;
    gameState.correctAnswers++;
    
    if (gameState.combo > gameState.maxCombo) {
        gameState.maxCombo = gameState.combo;
    }
    
    if (gameState.combo >= 3) {
        showCombo();
    }
}

function handleWrongAnswer(level) {
    showFeedback('âŒ');
    playSound('wrong');
    
    gameState.combo = 0;
    hideCombo();
    
    gameState.maxFuel = Math.max(gameState.maxFuel - level.fuelPenalty, 5);
    gameState.fuel = Math.min(gameState.fuel, gameState.maxFuel);
    
    gameState.wrongAnswers++;
}

function createCoinAnimation(amount) {
    const coin = document.createElement('div');
    coin.className = 'coin-animation';
    coin.textContent = `ðŸ’° +${amount}`;
    coin.style.left = '50%';
    coin.style.top = '50%';
    document.body.appendChild(coin);
    
    setTimeout(() => coin.remove(), 1000);
}

function startFuelTimer() {
    if (gameState.fuelTimer) {
        clearInterval(gameState.fuelTimer);
    }
    
    gameState.fuelTimer = setInterval(() => {
        if (gameState.currentLevel === 'infinite') return;
        
        gameState.fuel--;
        updateGameUI();
        
        if (gameState.fuel <= 0) {
            endGame();
        }
    }, 1000);
}

function updateGameUI() {
    document.getElementById('gameScore').textContent = gameState.score;
    document.getElementById('gameAltitude').textContent = gameState.altitude;
    document.getElementById('gameRecord').textContent = gameState.bestAltitude;
    document.getElementById('gameCoins').textContent = gameState.coins;
    document.getElementById('fuelTime').textContent = gameState.fuel;
    
    const fuelPercent = (gameState.fuel / gameState.maxFuel) * 100;
    const fuelFill = document.getElementById('fuelFill');
    fuelFill.style.width = fuelPercent + '%';
    document.getElementById('fuelPercent').textContent = Math.round(fuelPercent) + '%';
    
    if (fuelPercent > 50) {
        fuelFill.style.background = 'linear-gradient(90deg, #2ecc71, #27ae60)';
    } else if (fuelPercent > 25) {
        fuelFill.style.background = 'linear-gradient(90deg, #f39c12, #e67e22)';
    } else {
        fuelFill.style.background = 'linear-gradient(90deg, #e74c3c, #c0392b)';
    }
}

function updateRocketPosition() {
    const rocket = document.getElementById('rocket');
    const container = document.querySelector('.rocket-area');
    const maxHeight = container.offsetHeight - 100;
    const newBottom = Math.min((gameState.altitude / 10), maxHeight);
    rocket.style.bottom = newBottom + 'px';
}

function showFeedback(emoji, text = '') {
    const feedback = document.getElementById('feedbackOverlay');
    const emojis = {
        'âœ…': ['âœ…', 'ðŸŽ‰', 'ðŸ‘', 'â­', 'ðŸŒŸ', 'ðŸ’«'],
        'âŒ': ['âŒ']
    };
    
    const randomEmoji = emoji === 'âœ…' 
        ? emojis['âœ…'][Math.floor(Math.random() * emojis['âœ…'].length)]
        : emoji;
    
    feedback.textContent = randomEmoji;
    feedback.style.color = emoji === 'âœ…' ? '#2ecc71' : '#e74c3c';
    feedback.classList.add('show');
    
    setTimeout(() => {
        feedback.classList.remove('show');
    }, 600);
}

function showCombo() {
    const comboBadge = document.getElementById('comboBadge');
    document.getElementById('comboCount').textContent = gameState.combo;
    comboBadge.classList.remove('hidden');
}

function hideCombo() {
    document.getElementById('comboBadge').classList.add('hidden');
}

function pauseGame() {
    if (confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒ Ø¨Ù‡ Ù…Ù†Ùˆ Ø¨Ø±Ú¯Ø±Ø¯ÛŒØŸ (Ù¾ÛŒØ´Ø±ÙØª Ø°Ø®ÛŒØ±Ù‡ Ù†Ù…ÛŒØ´Ù‡)')) {
        if (gameState.fuelTimer) {
            clearInterval(gameState.fuelTimer);
            gameState.fuelTimer = null;
        }
        gameState.isPlaying = false;
        saveGameData();
        backToMainMenu();
    }
}

function endGame() {
    if (gameState.fuelTimer) {
        clearInterval(gameState.fuelTimer);
    }
    
    gameState.isPlaying = false;
    gameState.totalGames++;
    
    checkMedals();
    
    let isNewRecord = false;
    if (gameState.altitude > gameState.bestAltitude) {
        gameState.bestAltitude = gameState.altitude;
        isNewRecord = true;
    }
    
    let coinReward = Math.floor(gameState.score / 10);
    if (isNewRecord) coinReward += 100;
    if (gameState.combo >= 10) coinReward += 50;
    if (gameState.combo >= 20) coinReward += 150;
    
    const level = gameLevels[gameState.currentLevel];
    coinReward = Math.floor(coinReward * level.coinMultiplier);
    
    if (level.coinMultiplier > 0) {
        gameState.coins += coinReward;
    }
    
    saveGameData();
    showGameOverModal(coinReward, isNewRecord);
}

function showGameOverModal(coinReward, isNewRecord) {
    const modal = document.getElementById('gameOverModal');
    
    if (isNewRecord) {
        document.getElementById('gameOverIcon').textContent = 'ðŸ†';
        document.getElementById('gameOverTitle').textContent = 'Ø±Ú©ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯! ðŸŽ‰';
        document.getElementById('gameOverSubtitle').textContent = 'Ø¹Ø§Ù„ÛŒ Ø¨ÙˆØ¯!';
    } else if (gameState.altitude >= 1000) {
        document.getElementById('gameOverIcon').textContent = 'ðŸŽ®';
        document.getElementById('gameOverTitle').textContent = 'Ø¹Ù…Ù„Ú©Ø±Ø¯ ÙÙˆÙ‚â€ŒØ§Ù„Ø¹Ø§Ø¯Ù‡!';
        document.getElementById('gameOverSubtitle').textContent = 'Ø¨Ù‡ Ø§ÛŒÙ† Ù…ÛŒÚ¯Ù† Ø§Ø³ØªØ§Ø¯!';
    } else if (gameState.altitude >= 500) {
        document.getElementById('gameOverIcon').textContent = 'ðŸ˜Ž';
        document.getElementById('gameOverTitle').textContent = 'Ø®ÙˆØ¨ Ø¨ÙˆØ¯!';
        document.getElementById('gameOverSubtitle').textContent = 'Ø¯Ø§Ø±ÛŒ Ø¨Ù‡ØªØ± Ù…ÛŒØ´ÛŒ!';
    } else {
        document.getElementById('gameOverIcon').textContent = 'ðŸŽ®';
        document.getElementById('gameOverTitle').textContent = 'Ø¨Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ø´Ø¯!';
        document.getElementById('gameOverSubtitle').textContent = 'Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡ØŒ Ø¨Ù‡ØªØ± Ù…ÛŒØ´ÛŒ!';
    }
    
    document.getElementById('finalAltitude').textContent = gameState.altitude + ' Ù…ØªØ±';
    document.getElementById('finalScore').textContent = gameState.score;
    document.getElementById('finalCorrect').textContent = gameState.correctAnswers;
    document.getElementById('finalWrong').textContent = gameState.wrongAnswers;
    document.getElementById('finalBestCombo').textContent = gameState.combo;
    document.getElementById('coinReward').textContent = `ðŸ’° +${coinReward} Ø³Ú©Ù‡`;
    
    if (newMedalsThisGame.length > 0) {
        document.getElementById('newMedalNotif').classList.remove('hidden');
        const medalsList = document.getElementById('newMedalsList');
        medalsList.innerHTML = '';
        
        newMedalsThisGame.forEach(medal => {
            const span = document.createElement('span');
            span.className = 'new-medal-item';
            span.textContent = medal.icon;
            medalsList.appendChild(span);
        });
    } else {
        document.getElementById('newMedalNotif').classList.add('hidden');
    }
    
    modal.classList.remove('hidden');
    hideCombo();
}

function restartGame() {
    document.getElementById('gameOverModal').classList.add('hidden');
    document.getElementById('rocket').style.bottom = '0px';
    startGame(gameState.currentLevel);
}

document.getElementById('answerInput').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        submitAnswer();
    }
});

function cleanup() {
    if (gameState.fuelTimer) {
        clearInterval(gameState.fuelTimer);
        gameState.fuelTimer = null;
    }
    
    if (shootingStarInterval) {
        clearInterval(shootingStarInterval);
        shootingStarInterval = null;
    }
}

function init() {
    console.log('%cðŸš€ Ø¨Ø§Ø²ÛŒ Ù…ÙˆØ´Ú© Ø±ÛŒØ§Ø¶ÛŒ', 'font-size: 24px; color: #667eea; font-weight: bold;');
    console.log('%cÙ†Ø³Ø®Ù‡ 2.1 ÙØ§ÛŒÙ†Ø§Ù„ - Ù‡Ù…Ù‡ Ù…Ø´Ú©Ù„Ø§Øª Ø­Ù„ Ø´Ø¯!', 'font-size: 14px; color: #7f8c8d;');
    
    const loading = document.getElementById('loadingScreen');
    if (loading) loading.classList.remove('hidden');
    
    loadGameData();
    createStars();
    updateMainMenuStats();
    updateStreakDisplay();
    initAudioContext();
    
    setTimeout(() => {
        if (loading) loading.classList.add('hidden');
        console.log('%câœ… Ø¨Ø§Ø²ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª!', 'font-size: 14px; color: #2ecc71;');
    }, 1000);
}

window.addEventListener('load', init);

window.addEventListener('beforeunload', function (e) {
    cleanup();
    if (gameState.isPlaying) {
        e.preventDefault();
        e.returnValue = '';
        return 'Ø¨Ø§Ø²ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§Ø³Øª. Ù…Ø·Ù…Ø¦Ù†ÛŒ Ù…ÛŒØ®ÙˆØ§ÛŒ Ø®Ø§Ø±Ø¬ Ø¨Ø´ÛŒØŸ';
    }
});

window.addEventListener('unload', cleanup);
    </script>
</body>
</html>
